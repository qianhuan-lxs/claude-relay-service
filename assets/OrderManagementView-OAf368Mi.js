import{r as d,q as A,x as r,z as t,L as v,R as B,Q as w,ac as _,Y as U,K as O,aq as q,aV as Q,P as l,u as c,y as o,C as $}from"./vue-vendor-Bsazo-x0.js";import{c as x,s as i}from"./index-DZAJWWtr.js";import{u as R}from"./useConfirm-CxD_hh6j.js";import{C as Y}from"./ConfirmModal-DFtiZLRc.js";import"./element-plus-CqiD73Lu.js";import"./vendor-Dr8jvgFu.js";const G={class:"tab-content"},H={class:"card p-4 sm:p-6"},J={class:"mb-4 flex flex-col gap-4 sm:mb-6 sm:flex-row sm:items-center sm:justify-between"},W={class:"flex gap-2"},X=["onClick"],Z={key:0,class:"flex justify-center py-8"},ee={key:1,class:"py-8 text-center text-gray-500"},te={key:2,class:"overflow-x-auto"},ae={class:"w-full border-collapse"},se={class:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100"},re={class:"px-4 py-3 text-sm text-gray-700 dark:text-gray-300"},le={class:"px-4 py-3 text-sm text-gray-700 dark:text-gray-300"},oe={class:"px-4 py-3 text-sm text-gray-700 dark:text-gray-300"},ne={class:"px-4 py-3"},de={class:"px-4 py-3 text-sm text-gray-500 dark:text-gray-400"},ie={class:"px-4 py-3"},ce={class:"flex gap-2"},ue=["disabled","onClick"],ge=["disabled","onClick"],xe={key:2,class:"text-xs text-gray-500"},ye={class:"w-full max-w-md rounded-lg bg-white p-6 shadow-xl dark:bg-gray-800"},me={class:"space-y-4"},pe=["value"],be={class:"mt-6 flex justify-end gap-2"},fe=["disabled"],Ee={__name:"OrderManagementView",setup(ve){const{showConfirmModal:M,confirmOptions:y,showConfirm:C,handleConfirm:F,handleCancel:V}=R(),k=d(!1),h=d([]),m=d(null),p=d(null),b=d(null),u=d(!1),n=d({userEmail:"",planId:""}),I=d([]),f=d(!1),S=[{label:"全部",value:null},{label:"待激活",value:"pending"},{label:"已激活",value:"activated"},{label:"已过期",value:"expired"}],D=a=>{m.value=a,g()},g=async()=>{k.value=!0;try{const a=m.value?`/admin/orders?status=${m.value}`:"/admin/orders",s=await x.get(a);s&&s.success&&(h.value=s.data||[])}catch(a){i("加载订单列表失败","error"),console.error("Failed to load orders:",a)}finally{k.value=!1}},K=async a=>{if(await C("确认激活","确定要激活这个订单吗？这将为用户生成 API Key。")){p.value=a;try{const e=await x.put(`/admin/orders/${a}/activate`);if(e&&e.success)i("订单激活成功","success"),await g();else throw new Error((e==null?void 0:e.error)||"激活失败")}catch(e){i(e.message||"激活订单失败","error"),console.error("Failed to activate order:",e)}finally{p.value=null}}},N=async a=>{if(await C("确认删除","确定要删除这个订单吗？此操作不可恢复。")){b.value=a;try{const e=await x.delete(`/admin/orders/${a}`);if(e&&e.success)i("订单删除成功","success"),await g();else throw new Error((e==null?void 0:e.error)||"删除失败")}catch(e){i(e.message||"删除订单失败","error"),console.error("Failed to delete order:",e)}finally{b.value=null}}},j=async()=>{try{const a=await x.get("/plans?includeInactive=true");a&&a.success&&(I.value=a.data||[])}catch(a){console.error("Failed to load plans:",a)}},z=async()=>{if(!n.value.userEmail||!n.value.planId){i("请填写用户邮箱和选择套餐","error");return}f.value=!0;try{const a=await x.post("/admin/orders",{userEmail:n.value.userEmail,planId:n.value.planId});if(a&&a.success)i("订单创建成功","success"),u.value=!1,n.value={userEmail:"",planId:""},await g();else throw new Error((a==null?void 0:a.error)||"创建失败")}catch(a){i(a.message||"创建订单失败","error"),console.error("Failed to create order:",a)}finally{f.value=!1}},L=a=>({pending:"待激活",activated:"已激活",expired:"已过期"})[a]||a,P=a=>({pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",activated:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",expired:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200"})[a]||"bg-gray-100 text-gray-800",T=a=>a?new Date(a).toLocaleString("zh-CN"):"-";return A(()=>{g(),j()}),(a,s)=>(o(),r("div",G,[t("div",H,[t("div",J,[s[5]||(s[5]=t("div",null,[t("h3",{class:"mb-1 text-lg font-bold text-gray-900 dark:text-gray-100 sm:mb-2 sm:text-xl"}," 订单管理 "),t("p",{class:"text-sm text-gray-600 dark:text-gray-400 sm:text-base"},"管理和激活用户订单")],-1)),t("div",W,[t("button",{class:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700",onClick:s[0]||(s[0]=e=>u.value=!0)}," 创建订单 "),(o(),r(w,null,_(S,e=>t("button",{key:e.value,class:$(["rounded-lg px-3 py-1.5 text-sm font-medium transition-colors",m.value===e.value?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"]),onClick:E=>D(e.value)},l(e.label),11,X)),64))])]),k.value?(o(),r("div",Z,s[6]||(s[6]=[t("div",{class:"loading-spinner"},null,-1)]))):h.value.length===0?(o(),r("div",ee,"暂无订单")):(o(),r("div",te,[t("table",ae,[s[7]||(s[7]=t("thead",null,[t("tr",{class:"border-b border-gray-200 dark:border-gray-700"},[t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 dark:text-gray-300"}," 订单ID "),t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 dark:text-gray-300"}," 用户 "),t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 dark:text-gray-300"}," 套餐 "),t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 dark:text-gray-300"}," 价格 "),t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 dark:text-gray-300"}," 状态 "),t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 dark:text-gray-300"}," 创建时间 "),t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 dark:text-gray-300"}," 操作 ")])],-1)),t("tbody",null,[(o(!0),r(w,null,_(h.value,e=>(o(),r("tr",{key:e.id,class:"border-b border-gray-100 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-800/50"},[t("td",se,l(e.id.substring(0,8))+"... ",1),t("td",re,l(e.userUsername||e.userId),1),t("td",le,l(e.planName),1),t("td",oe,"¥"+l(e.price),1),t("td",ne,[t("span",{class:$(["inline-block rounded-full px-2 py-1 text-xs font-medium",P(e.status)])},l(L(e.status)),3)]),t("td",de,l(T(e.createdAt)),1),t("td",ie,[t("div",ce,[e.status==="pending"?(o(),r("button",{key:0,class:"rounded-lg bg-green-600 px-3 py-1.5 text-xs font-medium text-white hover:bg-green-700 disabled:opacity-50",disabled:p.value===e.id,onClick:E=>K(e.id)},l(p.value===e.id?"激活中...":"激活"),9,ue)):v("",!0),e.status==="pending"||e.status==="expired"?(o(),r("button",{key:1,class:"rounded-lg bg-red-600 px-3 py-1.5 text-xs font-medium text-white hover:bg-red-700 disabled:opacity-50",disabled:b.value===e.id,onClick:E=>N(e.id)},l(b.value===e.id?"删除中...":"删除"),9,ge)):v("",!0),e.status==="activated"?(o(),r("span",xe," API Key: "+l(e.apiKeyId?e.apiKeyId.substring(0,8)+"...":"-"),1)):v("",!0)])])]))),128))])])]))]),u.value?(o(),r("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:s[4]||(s[4]=U(e=>u.value=!1,["self"]))},[t("div",ye,[s[11]||(s[11]=t("h3",{class:"mb-4 text-lg font-bold text-gray-900 dark:text-gray-100"},"创建订单",-1)),t("div",me,[t("div",null,[s[8]||(s[8]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 用户邮箱 ",-1)),O(t("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>n.value.userEmail=e),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100",placeholder:"请输入用户邮箱",type:"email"},null,512),[[q,n.value.userEmail]])]),t("div",null,[s[10]||(s[10]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 套餐 ",-1)),O(t("select",{"onUpdate:modelValue":s[2]||(s[2]=e=>n.value.planId=e),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100"},[s[9]||(s[9]=t("option",{value:""},"请选择套餐",-1)),(o(!0),r(w,null,_(I.value,e=>(o(),r("option",{key:e.id,value:e.id},l(e.name)+" - ¥"+l(e.price),9,pe))),128))],512),[[Q,n.value.planId]])])]),t("div",be,[t("button",{class:"rounded-lg bg-gray-200 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",onClick:s[3]||(s[3]=e=>u.value=!1)}," 取消 "),t("button",{class:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50",disabled:f.value,onClick:z},l(f.value?"创建中...":"创建"),9,fe)])])])):v("",!0),B(Y,{"cancel-text":c(y).cancelText,"confirm-text":c(y).confirmText,message:c(y).message,show:c(M),title:c(y).title,onCancel:c(V),onConfirm:c(F)},null,8,["cancel-text","confirm-text","message","show","title","onCancel","onConfirm"])]))}};export{Ee as default};
