import{r as p,o as Q,x as d,L as C,y as n,z as e,P as r,K as U,aV as E,Q as Y,ac as G,C as V,Y as te,an as Z,O as q,_ as le,aq as R,al as re,c as se,q as oe,R as O,u as ee}from"./vue-vendor-Bsazo-x0.js";import{_ as X,c as B,s as _}from"./index-CeT09p7p.js";import{C as ae}from"./ConfirmModal-DtNxIjoq.js";import{d as ie}from"./vendor-Dr8jvgFu.js";import"./element-plus-CqiD73Lu.js";const de={key:0,class:"fixed inset-0 z-50 h-full w-full overflow-y-auto bg-gray-600 bg-opacity-50"},ne={class:"relative top-10 mx-auto w-4/5 max-w-4xl rounded-md border bg-white p-5 shadow-lg"},ue={class:"mt-3"},ce={class:"mb-6 flex items-center justify-between"},xe={class:"text-lg font-medium text-gray-900"},me={class:"text-sm text-gray-500"},ge={class:"mb-6"},ve={key:0,class:"py-12 text-center"},ye={key:1,class:"space-y-6"},pe={class:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4"},fe={class:"overflow-hidden rounded-lg bg-blue-50 shadow"},be={class:"p-5"},he={class:"flex items-center"},ke={class:"ml-5 w-0 flex-1"},we={class:"text-lg font-medium text-blue-900"},$e={class:"overflow-hidden rounded-lg bg-green-50 shadow"},_e={class:"p-5"},Ce={class:"flex items-center"},Me={class:"ml-5 w-0 flex-1"},Ae={class:"text-lg font-medium text-green-900"},Ue={class:"overflow-hidden rounded-lg bg-purple-50 shadow"},je={class:"p-5"},ze={class:"flex items-center"},Ve={class:"ml-5 w-0 flex-1"},Be={class:"text-lg font-medium text-purple-900"},Le={class:"overflow-hidden rounded-lg bg-yellow-50 shadow"},Ie={class:"p-5"},Se={class:"flex items-center"},Te={class:"ml-5 w-0 flex-1"},Ke={class:"text-lg font-medium text-yellow-900"},Ne={key:0,class:"rounded-lg border border-gray-200 bg-white"},Pe={class:"overflow-hidden"},De={class:"min-w-full divide-y divide-gray-200"},Fe={class:"divide-y divide-gray-200 bg-white"},Re={class:"whitespace-nowrap px-6 py-4"},qe={class:"text-sm font-medium text-gray-900"},He={class:"text-sm text-gray-500"},Oe={class:"whitespace-nowrap px-6 py-4"},Ee={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-900"},Qe={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-900"},Ye={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-900"},Ge={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},Je={class:"rounded-lg border border-gray-200 bg-white"},We={class:"p-6"},Xe={class:"flex h-64 items-center justify-center rounded-lg border-2 border-dashed border-gray-300"},Ze={class:"text-center"},et={class:"mt-1 text-sm text-gray-500"},tt={key:1,class:"py-12 text-center"},st={class:"mt-6 flex justify-end"},ot={__name:"UserUsageStatsModal",props:{show:{type:Boolean,default:!1},user:{type:Object,default:null}},emits:["close"],setup(f,{emit:M}){const v=f,$=M,u=p(!1),y=p("week"),g=p(null),l=p(null),a=b=>b>=1e6?(b/1e6).toFixed(1)+"M":b>=1e3?(b/1e3).toFixed(1)+"K":b.toString(),c=b=>b?new Date(b).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):null,h=async()=>{if(v.user){u.value=!0;try{const[b,o]=await Promise.all([B.get(`/users/${v.user.id}/usage-stats`,{params:{period:y.value}}),B.get(`/users/${v.user.id}`)]);b.success&&(g.value=b.stats),o.success&&(l.value=o.user)}catch(b){console.error("Failed to load user usage stats:",b),_("Failed to load usage statistics","error")}finally{u.value=!1}}};return Q([()=>v.show,()=>v.user],([b,o])=>{b&&o&&h()}),(b,o)=>{var j,S,T,I,x,s,A,K,N,P;return f.show?(n(),d("div",de,[e("div",ne,[e("div",ue,[e("div",ce,[e("div",null,[e("h3",xe," Usage Statistics - "+r(((j=f.user)==null?void 0:j.displayName)||((S=f.user)==null?void 0:S.username)),1),e("p",me,"@"+r((T=f.user)==null?void 0:T.username)+" • "+r((I=f.user)==null?void 0:I.role),1)]),e("button",{class:"text-gray-400 hover:text-gray-600",onClick:o[0]||(o[0]=k=>$("close"))},o[3]||(o[3]=[e("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M6 18L18 6M6 6l12 12","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)]))]),e("div",ge,[U(e("select",{"onUpdate:modelValue":o[1]||(o[1]=k=>y.value=k),class:"block w-32 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",onChange:h},o[4]||(o[4]=[e("option",{value:"day"},"Last 24 Hours",-1),e("option",{value:"week"},"Last 7 Days",-1),e("option",{value:"month"},"Last 30 Days",-1),e("option",{value:"quarter"},"Last 90 Days",-1)]),544),[[E,y.value]])]),u.value?(n(),d("div",ve,o[5]||(o[5]=[e("svg",{class:"mx-auto h-8 w-8 animate-spin text-blue-600",fill:"none",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",fill:"currentColor"})],-1),e("p",{class:"mt-2 text-sm text-gray-500"},"Loading usage statistics...",-1)]))):(n(),d("div",ye,[e("div",pe,[e("div",fe,[e("div",be,[e("div",he,[o[7]||(o[7]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M13 10V3L4 14h7v7l9-11h-7z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",ke,[e("dl",null,[o[6]||(o[6]=e("dt",{class:"truncate text-sm font-medium text-blue-600"},"Requests",-1)),e("dd",we,r(a(((x=g.value)==null?void 0:x.totalRequests)||0)),1)])])])])]),e("div",$e,[e("div",_e,[e("div",Ce,[o[9]||(o[9]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",Me,[e("dl",null,[o[8]||(o[8]=e("dt",{class:"truncate text-sm font-medium text-green-600"},"Input Tokens",-1)),e("dd",Ae,r(a(((s=g.value)==null?void 0:s.totalInputTokens)||0)),1)])])])])]),e("div",Ue,[e("div",je,[e("div",ze,[o[11]||(o[11]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",Ve,[e("dl",null,[o[10]||(o[10]=e("dt",{class:"truncate text-sm font-medium text-purple-600"},"Output Tokens",-1)),e("dd",Be,r(a(((A=g.value)==null?void 0:A.totalOutputTokens)||0)),1)])])])])]),e("div",Le,[e("div",Ie,[e("div",Se,[o[13]||(o[13]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",Te,[e("dl",null,[o[12]||(o[12]=e("dt",{class:"truncate text-sm font-medium text-yellow-600"},"Total Cost",-1)),e("dd",Ke," $"+r((((K=g.value)==null?void 0:K.totalCost)||0).toFixed(4)),1)])])])])])]),((P=(N=l.value)==null?void 0:N.apiKeys)==null?void 0:P.length)>0?(n(),d("div",Ne,[o[15]||(o[15]=e("div",{class:"border-b border-gray-200 px-4 py-5 sm:px-6"},[e("h4",{class:"text-lg font-medium leading-6 text-gray-900"},"API Keys Usage")],-1)),e("div",Pe,[e("table",De,[o[14]||(o[14]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",scope:"col"}," API Key "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",scope:"col"}," Status "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",scope:"col"}," Requests "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",scope:"col"}," Tokens "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",scope:"col"}," Cost "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",scope:"col"}," Last Used ")])],-1)),e("tbody",Fe,[(n(!0),d(Y,null,G(l.value.apiKeys,k=>{var D,F,i,t;return n(),d("tr",{key:k.id},[e("td",Re,[e("div",qe,r(k.name),1),e("div",He,r(k.keyPreview),1)]),e("td",Oe,[e("span",{class:V(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",k.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},r(k.isActive?"Active":"Disabled"),3)]),e("td",Ee,r(a(((D=k.usage)==null?void 0:D.requests)||0)),1),e("td",Qe,[e("div",null,"In: "+r(a(((F=k.usage)==null?void 0:F.inputTokens)||0)),1),e("div",null,"Out: "+r(a(((i=k.usage)==null?void 0:i.outputTokens)||0)),1)]),e("td",Ye," $"+r((((t=k.usage)==null?void 0:t.totalCost)||0).toFixed(4)),1),e("td",Ge,r(k.lastUsedAt?c(k.lastUsedAt):"Never"),1)])}),128))])])])])):C("",!0),e("div",Je,[o[19]||(o[19]=e("div",{class:"border-b border-gray-200 px-4 py-5 sm:px-6"},[e("h4",{class:"text-lg font-medium leading-6 text-gray-900"},"Usage Trend")],-1)),e("div",We,[e("div",Xe,[e("div",Ze,[o[16]||(o[16]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)),o[17]||(o[17]=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Usage Chart",-1)),e("p",et," Daily usage trends for "+r(y.value)+" period ",1),o[18]||(o[18]=e("p",{class:"mt-2 text-xs text-gray-400"}," (Chart integration can be added with Chart.js, D3.js, or similar library) ",-1))])])])]),g.value&&g.value.totalRequests===0?(n(),d("div",tt,o[20]||(o[20]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1),e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No usage data",-1),e("p",{class:"mt-1 text-sm text-gray-500"}," This user hasn't made any API requests in the selected period. ",-1)]))):C("",!0)])),e("div",st,[e("button",{class:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",onClick:o[2]||(o[2]=k=>b.$emit("close"))}," Close ")])])])])):C("",!0)}}},lt=X(ot,[["__scopeId","data-v-3ed8ad13"]]),rt={key:0,class:"fixed inset-0 z-50 h-full w-full overflow-y-auto bg-gray-600 bg-opacity-50"},at={class:"relative top-20 mx-auto w-96 rounded-md border bg-white p-5 shadow-lg"},it={class:"mt-3"},dt={class:"mb-4 flex items-center justify-between"},nt={key:0,class:"space-y-4"},ut={class:"rounded-md bg-gray-50 p-4"},ct={class:"flex items-center"},xt={class:"ml-4"},mt={class:"text-sm font-medium text-gray-900"},gt={class:"text-sm text-gray-500"},vt={class:"mt-1"},yt={class:"space-y-2"},pt={class:"flex items-center"},ft=["disabled"],bt={class:"flex items-center"},ht=["disabled"],kt={key:0,class:"rounded-md border border-yellow-200 bg-yellow-50 p-4"},wt={class:"flex"},$t={class:"ml-3"},_t={class:"mt-2 text-sm text-yellow-700"},Ct={key:0},Mt={key:1},At={key:1,class:"rounded-md border border-red-200 bg-red-50 p-4"},Ut={class:"flex"},jt={class:"ml-3"},zt={class:"text-sm text-red-700"},Vt={class:"flex justify-end space-x-3 pt-4"},Bt=["disabled"],Lt=["disabled"],It={key:0,class:"flex items-center"},St={key:1},Tt={__name:"ChangeRoleModal",props:{show:{type:Boolean,default:!1},user:{type:Object,default:null}},emits:["close","updated"],setup(f,{emit:M}){const v=f,$=M,u=p(!1),y=p(""),g=p(""),l=async()=>{var a,c;if(!(!v.user||g.value===v.user.role)){u.value=!0,y.value="";try{const h=await B.patch(`/users/${v.user.id}/role`,{role:g.value});h.success?(_(`用户角色已更新为${g.value==="admin"?"管理员":"普通用户"}`,"success"),$("updated")):y.value=h.message||"更新用户角色失败"}catch(h){console.error("Update user role error:",h),y.value=((c=(a=h.response)==null?void 0:a.data)==null?void 0:c.message)||h.message||"更新用户角色失败"}finally{u.value=!1}}};return Q([()=>v.show,()=>v.user],([a,c])=>{a&&c&&(g.value=c.role,y.value="",u.value=!1)}),(a,c)=>f.show?(n(),d("div",rt,[e("div",at,[e("div",it,[e("div",dt,[c[5]||(c[5]=e("h3",{class:"text-lg font-medium text-gray-900"},"修改用户角色",-1)),e("button",{class:"text-gray-400 hover:text-gray-600",onClick:c[0]||(c[0]=h=>a.$emit("close"))},c[4]||(c[4]=[e("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M6 18L18 6M6 6l12 12","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)]))]),f.user?(n(),d("div",nt,[e("div",ut,[e("div",ct,[c[6]||(c[6]=e("div",{class:"flex-shrink-0"},[e("div",{class:"flex h-10 w-10 items-center justify-center rounded-full bg-gray-300"},[e("svg",{class:"h-6 w-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])])],-1)),e("div",xt,[e("p",mt,r(f.user.displayName||f.user.username),1),e("p",gt,"@"+r(f.user.username),1),e("div",vt,[e("span",{class:V(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",f.user.role==="admin"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"])}," 当前："+r(f.user.role==="admin"?"管理员":"普通用户"),3)])])])]),e("form",{class:"space-y-4",onSubmit:te(l,["prevent"])},[e("div",null,[c[9]||(c[9]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700"},"新角色",-1)),e("div",yt,[e("label",pt,[U(e("input",{"onUpdate:modelValue":c[1]||(c[1]=h=>g.value=h),class:"h-4 w-4 border-gray-300 text-blue-600 focus:ring-blue-500",disabled:u.value,type:"radio",value:"user"},null,8,ft),[[Z,g.value]]),c[7]||(c[7]=e("div",{class:"ml-3"},[e("div",{class:"text-sm font-medium text-gray-900"},"普通用户"),e("div",{class:"text-xs text-gray-500"},"具有基本权限的普通用户")],-1))]),e("label",bt,[U(e("input",{"onUpdate:modelValue":c[2]||(c[2]=h=>g.value=h),class:"h-4 w-4 border-gray-300 text-blue-600 focus:ring-blue-500",disabled:u.value,type:"radio",value:"admin"},null,8,ht),[[Z,g.value]]),c[8]||(c[8]=e("div",{class:"ml-3"},[e("div",{class:"text-sm font-medium text-gray-900"},"管理员"),e("div",{class:"text-xs text-gray-500"},"拥有管理用户和系统的完整权限")],-1))])])]),g.value!==f.user.role?(n(),d("div",kt,[e("div",wt,[c[11]||(c[11]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"clip-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","fill-rule":"evenodd"})])],-1)),e("div",$t,[c[10]||(c[10]=e("h3",{class:"text-sm font-medium text-yellow-800"},"角色变更警告",-1)),e("div",_t,[g.value==="admin"?(n(),d("p",Ct," 授予管理员权限将使该用户拥有系统的完全访问权限，包括管理其他用户及其 API Keys 的能力。 ")):(n(),d("p",Mt," 移除管理员权限将限制该用户只能管理自己的 API Keys 和查看自己的使用统计。 "))])])])])):C("",!0),y.value?(n(),d("div",At,[e("div",Ut,[c[12]||(c[12]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"clip-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","fill-rule":"evenodd"})])],-1)),e("div",jt,[e("p",zt,r(y.value),1)])])])):C("",!0),e("div",Vt,[e("button",{class:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50",disabled:u.value,type:"button",onClick:c[3]||(c[3]=h=>a.$emit("close"))}," 取消 ",8,Bt),e("button",{class:"rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",disabled:u.value||g.value===f.user.role,type:"submit"},[u.value?(n(),d("span",It,c[13]||(c[13]=[e("svg",{class:"-ml-1 mr-2 h-4 w-4 animate-spin text-white",fill:"none",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",fill:"currentColor"})],-1),q(" 更新中... ",-1)]))):(n(),d("span",St,"更新角色"))],8,Lt)])],32)])):C("",!0)])])])):C("",!0)}},Kt=X(Tt,[["__scopeId","data-v-baae05d0"]]),Nt={key:0,class:"fixed inset-0 z-50 h-full w-full overflow-y-auto bg-gray-900/60"},Pt={class:"relative top-10 mx-auto w-full max-w-xl rounded-lg bg-white shadow dark:bg-gray-800"},Dt={class:"flex items-center justify-between border-b px-6 py-4 dark:border-gray-700"},Ft={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Rt={class:"sm:col-span-2"},qt={class:"flex items-center space-x-2"},Ht={class:"flex items-center justify-end space-x-3 pt-2"},Ot=["disabled"],Et={key:0,class:"-ml-1 mr-2 h-4 w-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},Qt={key:1},Yt={__name:"CreateUserModal",props:{show:{type:Boolean,default:!1}},emits:["close","created"],setup(f,{emit:M}){const v=M,$=p(!1),u=le({username:"",displayName:"",email:"",firstName:"",lastName:"",role:"user",isActive:!0});async function y(){var g,l;if(!u.username){_("用户名为必填项","error");return}$.value=!0;try{const a=await B.post("/users",{...u});a&&a.success?(_("用户创建成功","success"),v("created",a.user),v("close")):_((a==null?void 0:a.message)||"创建失败","error")}catch(a){_(((l=(g=a==null?void 0:a.response)==null?void 0:g.data)==null?void 0:l.message)||a.message||"创建失败","error")}finally{$.value=!1}}return(g,l)=>f.show?(n(),d("div",Nt,[e("div",Pt,[e("div",Dt,[l[10]||(l[10]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"创建用户",-1)),e("button",{class:"text-gray-400 hover:text-gray-600",onClick:l[0]||(l[0]=a=>v("close"))},l[9]||(l[9]=[e("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M6 18L18 6M6 6l12 12","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)]))]),e("form",{class:"space-y-4 px-6 py-5",onSubmit:te(y,["prevent"])},[e("div",Ft,[e("div",Rt,[l[11]||(l[11]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},"用户名",-1)),U(e("input",{"onUpdate:modelValue":l[1]||(l[1]=a=>u.username=a),class:"block w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",placeholder:"必填",required:""},null,512),[[R,u.username,void 0,{trim:!0}]])]),e("div",null,[l[12]||(l[12]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},"显示名称",-1)),U(e("input",{"onUpdate:modelValue":l[2]||(l[2]=a=>u.displayName=a),class:"block w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",placeholder:"可选"},null,512),[[R,u.displayName,void 0,{trim:!0}]])]),e("div",null,[l[13]||(l[13]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},"邮箱",-1)),U(e("input",{"onUpdate:modelValue":l[3]||(l[3]=a=>u.email=a),class:"block w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",placeholder:"可选",type:"email"},null,512),[[R,u.email,void 0,{trim:!0}]])]),e("div",null,[l[14]||(l[14]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},"名",-1)),U(e("input",{"onUpdate:modelValue":l[4]||(l[4]=a=>u.firstName=a),class:"block w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",placeholder:"可选"},null,512),[[R,u.firstName,void 0,{trim:!0}]])]),e("div",null,[l[15]||(l[15]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},"姓",-1)),U(e("input",{"onUpdate:modelValue":l[5]||(l[5]=a=>u.lastName=a),class:"block w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",placeholder:"可选"},null,512),[[R,u.lastName,void 0,{trim:!0}]])]),e("div",null,[l[17]||(l[17]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},"角色",-1)),U(e("select",{"onUpdate:modelValue":l[6]||(l[6]=a=>u.role=a),class:"block w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm"},l[16]||(l[16]=[e("option",{value:"user"},"user",-1),e("option",{value:"admin"},"admin",-1)]),512),[[E,u.role]])]),e("div",qt,[U(e("input",{id:"active","onUpdate:modelValue":l[7]||(l[7]=a=>u.isActive=a),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500",type:"checkbox"},null,512),[[re,u.isActive]]),l[18]||(l[18]=e("label",{class:"text-sm text-gray-700 dark:text-gray-300",for:"active"},"启用",-1))])]),e("div",Ht,[e("button",{class:"rounded-md border px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-gray-700",type:"button",onClick:l[8]||(l[8]=a=>v("close"))}," 取消 "),e("button",{class:"inline-flex items-center rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow hover:bg-blue-700 disabled:opacity-50",disabled:$.value,type:"submit"},[$.value?(n(),d("svg",Et,l[19]||(l[19]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",fill:"currentColor"},null,-1)]))):C("",!0),l[20]||(l[20]=q(" 创建 ",-1))],8,Ot)])],32)])])):(n(),d("div",Qt))}},Gt={key:0,class:"fixed inset-0 z-50 h-full w-full overflow-y-auto bg-gray-900/60"},Jt={class:"relative top-8 mx-auto w-11/12 max-w-5xl rounded-lg bg-white shadow dark:bg-gray-800"},Wt={class:"flex items-center justify-between border-b px-6 py-4 dark:border-gray-700"},Xt={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},Zt={class:"px-6 py-5"},es={class:"mb-4 flex flex-wrap items-center justify-between gap-3"},ts={class:"space-y-1"},ss={class:"text-sm text-gray-700 dark:text-gray-300"},os={class:"text-sm text-gray-700 dark:text-gray-300"},ls={class:"text-sm text-gray-700 dark:text-gray-300"},rs={class:"border-b dark:border-gray-700"},as={"aria-label":"Tabs",class:"-mb-px flex space-x-6"},is={class:"pt-4"},ds={key:0},ns={class:"overflow-x-auto"},us={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},cs={class:"divide-y divide-gray-100 dark:divide-gray-700"},xs={class:"px-4 py-2 text-sm text-gray-800 dark:text-gray-200"},ms={class:"px-4 py-2"},gs={class:"flex items-center gap-2"},vs=["title"],ys={key:1,class:"text-xs text-gray-400"},ps=["onClick"],fs={class:"px-4 py-2 text-sm text-gray-600 dark:text-gray-300"},bs={class:"px-4 py-2 text-sm text-gray-600 dark:text-gray-300"},hs={class:"px-4 py-2 text-sm text-gray-600 dark:text-gray-300"},ks={class:"px-4 py-2 text-sm"},ws={class:"px-4 py-2 text-sm text-gray-600 dark:text-gray-300"},$s={key:0},_s={key:1},Cs={class:"overflow-x-auto"},Ms={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},As={class:"divide-y divide-gray-100 dark:divide-gray-700"},Us={class:"px-4 py-2 font-mono text-sm text-gray-800 dark:text-gray-200"},js={class:"px-4 py-2 text-sm"},zs={class:"px-4 py-2 text-sm text-gray-600 dark:text-gray-300"},Vs={class:"px-4 py-2 text-sm text-gray-600 dark:text-gray-300"},Bs={key:0},Ls={key:2},Is={class:"space-y-6"},Ss={class:"flex items-center justify-between"},Ts={key:0,class:"py-8 text-center"},Ks={key:1,class:"grid grid-cols-1 gap-4 md:grid-cols-4"},Ns={class:"rounded-lg bg-gray-50 p-4 dark:bg-gray-700"},Ps={class:"mt-1 text-2xl font-semibold text-gray-900 dark:text-white"},Ds={class:"rounded-lg bg-gray-50 p-4 dark:bg-gray-700"},Fs={class:"mt-1 text-2xl font-semibold text-gray-900 dark:text-white"},Rs={class:"rounded-lg bg-gray-50 p-4 dark:bg-gray-700"},qs={class:"mt-1 text-2xl font-semibold text-gray-900 dark:text-white"},Hs={class:"rounded-lg bg-gray-50 p-4 dark:bg-gray-700"},Os={class:"mt-1 text-2xl font-semibold text-gray-900 dark:text-white"},Es={key:2,class:"py-8 text-center"},Qs={key:1},Ys={__name:"UserDetailModal",props:{show:{type:Boolean,default:!1},user:{type:Object,default:null}},emits:["close"],setup(f,{emit:M}){const v=f,$=M,u=p("keys"),y=p(null),g=p([]),l=p(!1),a=p(null),c=p("week"),h=se(()=>{var x,s;return((s=(x=y.value)==null?void 0:x.user)==null?void 0:s.apiKeys)||[]});function b(x){return["border-b-2 px-3 py-2 text-sm font-medium",u.value===x?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"]}function o(x){return x>=1e6?(x/1e6).toFixed(1)+"M":x>=1e3?(x/1e3).toFixed(1)+"K":String(x||0)}function j(x){if(!x)return"-";try{return new Date(x).toLocaleString()}catch{return"-"}}async function S(x){if(x)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(x),_("已复制到剪贴板","success");else{const s=document.createElement("textarea");s.value=x,s.style.position="fixed",s.style.opacity="0",document.body.appendChild(s),s.select();try{document.execCommand("copy"),_("已复制到剪贴板","success")}catch{_("复制失败，请手动复制","error")}document.body.removeChild(s)}}catch(s){console.error("复制失败:",s),_("复制失败，请手动复制","error")}}async function T(){var x;if((x=v.user)!=null&&x.id)try{const[s,A]=await Promise.all([B.get(`/users/${v.user.id}`),B.get(`/users/${v.user.id}/redeems`)]);s!=null&&s.success&&(y.value=s),A!=null&&A.success&&(g.value=A.redeems||A.data||[])}catch{_("加载用户详情失败","error")}}async function I(){var x;if((x=v.user)!=null&&x.id){l.value=!0;try{const s=await B.get(`/users/${v.user.id}/usage-stats`,{params:{period:c.value}});s!=null&&s.success&&(a.value=s.stats)}catch(s){console.error("Failed to load usage stats:",s),_("加载使用统计失败","error")}finally{l.value=!1}}}return Q(()=>v.show,x=>{x&&(u.value="keys",T(),u.value==="usage"&&I())}),Q(()=>u.value,x=>{x==="usage"&&v.show&&I()}),oe(()=>{v.show&&(T(),u.value==="usage"&&I())}),(x,s)=>{var A,K,N,P,k,D,F,i;return f.show?(n(),d("div",Gt,[e("div",Jt,[e("div",Wt,[e("div",null,[s[5]||(s[5]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"用户详情",-1)),f.user?(n(),d("p",Xt," @"+r(f.user.username)+" · "+r(f.user.role),1)):C("",!0)]),e("button",{class:"text-gray-400 hover:text-gray-600",onClick:s[0]||(s[0]=t=>$("close"))},s[6]||(s[6]=[e("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M6 18L18 6M6 6l12 12","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)]))]),e("div",Zt,[e("div",es,[e("div",ts,[e("div",ss," 昵称："+r(((K=(A=y.value)==null?void 0:A.user)==null?void 0:K.displayName)||"-"),1),e("div",os," 邮箱："+r(((P=(N=y.value)==null?void 0:N.user)==null?void 0:P.email)||"-"),1),e("div",ls,[s[7]||(s[7]=q(" 状态： ",-1)),e("span",{class:V((D=(k=y.value)==null?void 0:k.user)!=null&&D.isActive?"text-green-600":"text-red-500")},r((i=(F=y.value)==null?void 0:F.user)!=null&&i.isActive?"启用":"禁用"),3)])])]),e("div",rs,[e("nav",as,[e("button",{class:V(b("keys")),onClick:s[1]||(s[1]=t=>u.value="keys")},"API Keys",2),e("button",{class:V(b("redeems")),onClick:s[2]||(s[2]=t=>u.value="redeems")},"兑换码",2),e("button",{class:V(b("usage")),onClick:s[3]||(s[3]=t=>u.value="usage")},"使用统计",2)])]),e("div",is,[u.value==="keys"?(n(),d("div",ds,[e("div",ns,[e("table",us,[s[10]||(s[10]=e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," 名称 "),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," API Key "),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," 请求数 "),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," Tokens (令牌数) "),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," 总消费 "),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," 状态 "),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," 创建时间 ")])],-1)),e("tbody",cs,[(n(!0),d(Y,null,G(h.value,t=>{var w,z,L,H;return n(),d("tr",{key:t.id},[e("td",xs,r(t.name),1),e("td",ms,[e("div",gs,[t.key?(n(),d("code",{key:0,class:"max-w-xs truncate rounded bg-gray-100 px-2 py-1 font-mono text-xs text-gray-800 dark:bg-gray-700 dark:text-gray-200",title:t.key},r(t.key),9,vs)):(n(),d("span",ys,"-")),t.key?(n(),d("button",{key:2,class:"inline-flex items-center rounded p-1 text-gray-400 hover:text-blue-600",title:"复制 API Key",onClick:J=>S(t.key)},s[8]||(s[8]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)]),8,ps)):C("",!0)])]),e("td",fs,r(o(((w=t.usage)==null?void 0:w.requests)||0)),1),e("td",bs,r(o((((z=t.usage)==null?void 0:z.inputTokens)||0)+(((L=t.usage)==null?void 0:L.outputTokens)||0))),1),e("td",hs," $"+r((((H=t.usage)==null?void 0:H.totalCost)||0).toFixed(4)),1),e("td",ks,[e("span",{class:V(t.isActive?"text-green-500":"text-red-500")},r(t.isActive?"活跃":"禁用"),3)]),e("td",ws,r(j(t.createdAt)),1)])}),128)),h.value.length===0?(n(),d("tr",$s,s[9]||(s[9]=[e("td",{class:"px-4 py-6 text-center text-sm text-gray-500",colspan:"7"}," 暂无 API Keys ",-1)]))):C("",!0)])])])])):u.value==="redeems"?(n(),d("div",_s,[e("div",Cs,[e("table",Ms,[s[12]||(s[12]=e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," 兑换码 "),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," 状态 "),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," 关联 Key "),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," 创建/激活时间 ")])],-1)),e("tbody",As,[(n(!0),d(Y,null,G(g.value,t=>(n(),d("tr",{key:t.code},[e("td",Us,r(t.code),1),e("td",js,[e("span",{class:V(t.status==="used"?"text-green-600":t.status==="unused"?"text-gray-500":"text-yellow-600")},r(t.status==="used"?"已使用":t.status==="unused"?"未使用":t.status==="expired"?"已过期":t.status),3)]),e("td",zs,r(t.apiKeyName||t.apiKeyId||"-"),1),e("td",Vs,r(j(t.activatedAt||t.createdAt)),1)]))),128)),g.value.length===0?(n(),d("tr",Bs,s[11]||(s[11]=[e("td",{class:"px-4 py-6 text-center text-sm text-gray-500",colspan:"4"}," 暂无兑换码 ",-1)]))):C("",!0)])])])])):(n(),d("div",Ls,[e("div",Is,[e("div",Ss,[s[14]||(s[14]=e("h4",{class:"text-sm font-medium text-gray-900 dark:text-white"},"使用统计",-1)),U(e("select",{"onUpdate:modelValue":s[4]||(s[4]=t=>c.value=t),class:"block w-40 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",onChange:I},s[13]||(s[13]=[e("option",{value:"day"},"最近 24 小时",-1),e("option",{value:"week"},"最近 7 天",-1),e("option",{value:"month"},"最近 30 天",-1),e("option",{value:"quarter"},"最近 90 天",-1)]),544),[[E,c.value]])]),l.value?(n(),d("div",Ts,s[15]||(s[15]=[e("svg",{class:"mx-auto h-8 w-8 animate-spin text-blue-600",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",fill:"currentColor"})],-1),e("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"},"加载中...",-1)]))):a.value?(n(),d("div",Ks,[e("div",Ns,[s[16]||(s[16]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"总请求数",-1)),e("div",Ps,r(o(a.value.totalRequests||0)),1)]),e("div",Ds,[s[17]||(s[17]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"输入 Tokens",-1)),e("div",Fs,r(o(a.value.totalInputTokens||0)),1)]),e("div",Rs,[s[18]||(s[18]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"输出 Tokens",-1)),e("div",qs,r(o(a.value.totalOutputTokens||0)),1)]),e("div",Hs,[s[19]||(s[19]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"总消费",-1)),e("div",Os," $"+r((a.value.totalCost||0).toFixed(4)),1)])])):(n(),d("div",Es,s[20]||(s[20]=[e("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"暂无使用数据",-1)])))])]))])])])])):(n(),d("div",Qs))}}},Gs={class:"space-y-6"},Js={class:"sm:flex sm:items-center"},Ws={class:"mt-4 space-x-3 sm:ml-16 sm:mt-0 sm:flex-none"},Xs=["disabled"],Zs=["disabled"],eo={class:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-4"},to={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},so={class:"p-5"},oo={class:"flex items-center"},lo={class:"ml-5 w-0 flex-1"},ro={class:"text-lg font-medium text-gray-900 dark:text-white"},ao={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},io={class:"p-5"},no={class:"flex items-center"},uo={class:"ml-5 w-0 flex-1"},co={class:"text-lg font-medium text-gray-900 dark:text-white"},xo={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},mo={class:"p-5"},go={class:"flex items-center"},vo={class:"ml-5 w-0 flex-1"},yo={class:"text-lg font-medium text-gray-900 dark:text-white"},po={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},fo={class:"p-5"},bo={class:"flex items-center"},ho={class:"ml-5 w-0 flex-1"},ko={class:"text-lg font-medium text-gray-900 dark:text-white"},wo={class:"rounded-lg bg-white shadow dark:bg-gray-800"},$o={class:"px-4 py-5 sm:p-6"},_o={class:"sm:flex sm:items-center sm:justify-between"},Co={class:"space-y-4 sm:flex sm:items-center sm:space-x-4 sm:space-y-0"},Mo={class:"min-w-0 flex-1"},Ao={class:"relative rounded-md shadow-sm"},Uo={class:"overflow-hidden bg-white shadow dark:bg-gray-800 sm:rounded-md"},jo={class:"border-b border-gray-200 px-4 py-5 dark:border-gray-700 sm:px-6"},zo={class:"text-lg font-medium leading-6 text-gray-900 dark:text-white"},Vo={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Bo={key:0,class:"py-12 text-center"},Lo={key:1,class:"divide-y divide-gray-200 dark:divide-gray-700",role:"list"},Io={class:"flex items-center justify-between"},So={class:"flex min-w-0 flex-1 items-center"},To={class:"ml-4 min-w-0 flex-1"},Ko={class:"flex items-center"},No={class:"truncate text-sm font-medium text-gray-900 dark:text-white"},Po={class:"ml-2 flex items-center space-x-2"},Do={class:"mt-1 flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400"},Fo={key:0},Ro={key:1},qo={key:2},Ho={key:0,class:"mt-1 flex items-center space-x-4 text-xs text-gray-400 dark:text-gray-500"},Oo={class:"flex items-center space-x-2"},Eo=["onClick"],Qo=["disabled","onClick"],Yo=["title","onClick"],Go={key:0,class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Jo={key:1,class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Wo=["onClick"],Xo={key:2,class:"py-12 text-center"},Zo={class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},el={__name:"UserManagementView",setup(f){const M=p(!0),v=p([]),$=p(null),u=p(""),y=p(""),g=p(""),l=p(!1),a=p(!1),c=p(!1),h=p(!1),b=p(!1),o=p(null),j=p({title:"",message:"",confirmText:"",confirmClass:"",action:null}),S=se(()=>{let i=v.value;if(u.value){const t=u.value.toLowerCase();i=i.filter(w=>{var z,L;return w.username.toLowerCase().includes(t)||((z=w.displayName)==null?void 0:z.toLowerCase().includes(t))||((L=w.email)==null?void 0:L.toLowerCase().includes(t))})}if(y.value&&(i=i.filter(t=>t.role===y.value)),g.value!==""){const t=g.value==="true";i=i.filter(w=>w.isActive===t)}return i}),T=i=>i>=1e6?(i/1e6).toFixed(1)+"M":i>=1e3?(i/1e3).toFixed(1)+"K":i.toString(),I=i=>i?new Date(i).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):null,x=async()=>{M.value=!0;try{const i={};y.value&&y.value.trim()!==""&&(i.role=y.value),g.value!==""&&(i.isActive=g.value);const[t,w]=await Promise.all([B.get("/users",{params:i}),B.get("/users/stats/overview")]);t.success&&(v.value=t.users),w.success&&($.value=w.stats)}catch(i){console.error("Failed to load users:",i),_("加载用户失败","error")}finally{M.value=!1}},s=ie(()=>{},300),A=i=>{o.value=i,b.value=!0},K=i=>{o.value=i,j.value={title:i.isActive?"禁用用户":"启用用户",message:i.isActive?`确定要禁用用户 "${i.username}" 吗？这将阻止他们登录。`:`确定要启用用户 "${i.username}" 吗？`,confirmText:i.isActive?"禁用":"启用",confirmClass:i.isActive?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700",action:"toggleStatus"},a.value=!0},N=i=>{i.apiKeyCount!==0&&(o.value=i,j.value={title:"禁用所有 API Keys",message:`确定要禁用用户 "${i.username}" 的所有 ${i.apiKeyCount} 个 API Keys 吗？这将阻止他们使用服务。`,confirmText:"禁用",confirmClass:"bg-red-600 hover:bg-red-700",action:"disableKeys"},a.value=!0)},P=i=>{o.value=i,c.value=!0},k=async()=>{const i=o.value,t=j.value.action;try{if(t==="toggleStatus"){if((await B.patch(`/users/${i.id}/status`,{isActive:!i.isActive})).success){const z=v.value.findIndex(L=>L.id===i.id);z!==-1&&(v.value[z].isActive=!i.isActive),_(`用户已${i.isActive?"禁用":"启用"}`,"success")}}else if(t==="disableKeys"){const w=await B.post(`/users/${i.id}/disable-keys`);w.success&&(_(`已禁用 ${w.disabledCount} 个 API Keys`,"success"),await x())}}catch(w){console.error(`Failed to ${t}:`,w),_(`操作失败：${t==="toggleStatus"?"更新用户状态":"禁用 API Keys"}`,"error")}finally{a.value=!1,o.value=null}},D=()=>{c.value=!1,o.value=null,x()},F=()=>{h.value=!1,x()};return oe(()=>{x()}),(i,t)=>{var w,z,L,H,J;return n(),d("div",Gs,[e("div",Js,[t[12]||(t[12]=e("div",{class:"sm:flex-auto"},[e("h1",{class:"text-2xl font-semibold text-gray-900 dark:text-white"},"用户管理"),e("p",{class:"mt-2 text-sm text-gray-700 dark:text-gray-300"},"管理用户、API Keys 和使用统计")],-1)),e("div",Ws,[e("button",{class:"inline-flex items-center justify-center rounded-md border border-transparent bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600",disabled:M.value,onClick:t[0]||(t[0]=m=>h.value=!0)},t[10]||(t[10]=[e("svg",{class:"-ml-1 mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 4v16m8-8H4","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1),q(" 创建用户 ",-1)]),8,Xs),e("button",{class:"inline-flex items-center justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 sm:w-auto",disabled:M.value,onClick:x},t[11]||(t[11]=[e("svg",{class:"-ml-1 mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1),q(" 刷新 ",-1)]),8,Zs)])]),e("div",eo,[e("div",to,[e("div",so,[e("div",oo,[t[14]||(t[14]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",lo,[e("dl",null,[t[13]||(t[13]=e("dt",{class:"truncate text-sm font-medium text-gray-500 dark:text-gray-400"}," 总用户数 ",-1)),e("dd",ro,r(((w=$.value)==null?void 0:w.totalUsers)||0),1)])])])])]),e("div",ao,[e("div",io,[e("div",no,[t[16]||(t[16]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",uo,[e("dl",null,[t[15]||(t[15]=e("dt",{class:"truncate text-sm font-medium text-gray-500 dark:text-gray-400"}," 活跃用户 ",-1)),e("dd",co,r(((z=$.value)==null?void 0:z.activeUsers)||0),1)])])])])]),e("div",xo,[e("div",mo,[e("div",go,[t[18]||(t[18]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M15 7a2 2 0 012 2m0 0a2 2 0 012 2m-2-2h-6m6 0v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9a2 2 0 012-2h6z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",vo,[e("dl",null,[t[17]||(t[17]=e("dt",{class:"truncate text-sm font-medium text-gray-500 dark:text-gray-400"}," 总 API Keys ",-1)),e("dd",yo,r(((L=$.value)==null?void 0:L.totalApiKeys)||0),1)])])])])]),e("div",po,[e("div",fo,[e("div",bo,[t[20]||(t[20]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-yellow-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",ho,[e("dl",null,[t[19]||(t[19]=e("dt",{class:"truncate text-sm font-medium text-gray-500 dark:text-gray-400"}," 总消费 ",-1)),e("dd",ko," $"+r((((J=(H=$.value)==null?void 0:H.totalUsage)==null?void 0:J.totalCost)||0).toFixed(4)),1)])])])])])]),e("div",wo,[e("div",$o,[e("div",_o,[e("div",Co,[e("div",Mo,[e("div",Ao,[t[21]||(t[21]=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),U(e("input",{"onUpdate:modelValue":t[1]||(t[1]=m=>u.value=m),class:"block w-full rounded-md border-gray-300 pl-10 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",placeholder:"搜索用户...",type:"search",onInput:t[2]||(t[2]=(...m)=>ee(s)&&ee(s)(...m))},null,544),[[R,u.value]])])]),e("div",null,[U(e("select",{"onUpdate:modelValue":t[3]||(t[3]=m=>y.value=m),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",onChange:x},t[22]||(t[22]=[e("option",{value:""},"所有角色",-1),e("option",{value:"user"},"普通用户",-1),e("option",{value:"admin"},"管理员",-1)]),544),[[E,y.value]])]),e("div",null,[U(e("select",{"onUpdate:modelValue":t[4]||(t[4]=m=>g.value=m),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",onChange:x},t[23]||(t[23]=[e("option",{value:""},"所有状态",-1),e("option",{value:"true"},"启用",-1),e("option",{value:"false"},"禁用",-1)]),544),[[E,g.value]])])])])])]),e("div",Uo,[e("div",jo,[e("h3",zo,[t[24]||(t[24]=q(" 用户列表 ",-1)),M.value?C("",!0):(n(),d("span",Vo,"("+r(S.value.length)+" / "+r(v.value.length)+")",1))])]),M.value?(n(),d("div",Bo,t[25]||(t[25]=[e("svg",{class:"mx-auto h-8 w-8 animate-spin text-blue-600",fill:"none",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",fill:"currentColor"})],-1),e("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"},"加载中...",-1)]))):S.value.length>0?(n(),d("ul",Lo,[(n(!0),d(Y,null,G(S.value,m=>(n(),d("li",{key:m.id,class:"px-6 py-4"},[e("div",Io,[e("div",So,[t[26]||(t[26]=e("div",{class:"flex-shrink-0"},[e("div",{class:"flex h-10 w-10 items-center justify-center rounded-full bg-gray-300 dark:bg-gray-600"},[e("svg",{class:"h-6 w-6 text-gray-600 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])])],-1)),e("div",To,[e("div",Ko,[e("p",No,r(m.displayName||m.username),1),e("div",Po,[e("span",{class:V(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",m.isActive?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"])},r(m.isActive?"启用":"禁用"),3),e("span",{class:V(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",m.role==="admin"?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"])},r(m.role==="admin"?"管理员":"普通用户"),3)])]),e("div",Do,[e("span",null,"@"+r(m.username),1),m.email?(n(),d("span",Fo,r(m.email),1)):C("",!0),e("span",null,r(m.apiKeyCount||0)+" 个 API Keys",1),m.lastLoginAt?(n(),d("span",Ro,"最后登录："+r(I(m.lastLoginAt)),1)):(n(),d("span",qo,"从未登录"))]),m.totalUsage?(n(),d("div",Ho,[e("span",null,r(T(m.totalUsage.requests||0))+" 次请求",1),e("span",null,"总消费 $"+r((m.totalUsage.totalCost||0).toFixed(4)),1)])):C("",!0)])]),e("div",Oo,[e("button",{class:"inline-flex items-center rounded border border-transparent p-1 text-gray-400 hover:text-blue-600",title:"查看详情",onClick:W=>A(m)},t[27]||(t[27]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)]),8,Eo),e("button",{class:"inline-flex items-center rounded border border-transparent p-1 text-gray-400 hover:text-red-600 disabled:cursor-not-allowed disabled:opacity-50",disabled:m.apiKeyCount===0,title:"禁用所有 API Keys",onClick:W=>N(m)},t[28]||(t[28]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18 12M6 6l12 12","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)]),8,Qo),e("button",{class:V(["inline-flex items-center rounded border border-transparent p-1",m.isActive?"text-gray-400 hover:text-red-600":"text-gray-400 hover:text-green-600"]),title:m.isActive?"禁用用户":"启用用户",onClick:W=>K(m)},[m.isActive?(n(),d("svg",Go,t[29]||(t[29]=[e("path",{d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18 12M6 6l12 12","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},null,-1)]))):(n(),d("svg",Jo,t[30]||(t[30]=[e("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},null,-1)])))],10,Yo),e("button",{class:"inline-flex items-center rounded border border-transparent p-1 text-gray-400 hover:text-purple-600",title:"修改角色",onClick:W=>P(m)},t[31]||(t[31]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)]),8,Wo)])])]))),128))])):(n(),d("div",Xo,[t[32]||(t[32]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)),t[33]||(t[33]=e("h3",{class:"mt-2 text-sm font-medium text-gray-900 dark:text-white"},"未找到用户",-1)),e("p",Zo,r(u.value?"没有匹配搜索条件的用户。":"还没有创建任何用户。"),1)]))]),O(lt,{show:l.value,user:o.value,onClose:t[5]||(t[5]=m=>l.value=!1)},null,8,["show","user"]),O(Yt,{show:h.value,onClose:t[6]||(t[6]=m=>h.value=!1),onCreated:F},null,8,["show"]),O(Ys,{show:b.value,user:o.value,onClose:t[7]||(t[7]=m=>b.value=!1)},null,8,["show","user"]),O(ae,{"confirm-class":j.value.confirmClass,"confirm-text":j.value.confirmText,message:j.value.message,show:a.value,title:j.value.title,onCancel:t[8]||(t[8]=m=>a.value=!1),onConfirm:k},null,8,["confirm-class","confirm-text","message","show","title"]),O(Kt,{show:c.value,user:o.value,onClose:t[9]||(t[9]=m=>c.value=!1),onUpdated:D},null,8,["show","user"])])}}},al=X(el,[["__scopeId","data-v-91c406a6"]]);export{al as default};
