import{s as p,c as h}from"./index-DyNxxe0W.js";import{r as x,_ as N,o as U,x as d,y as u,z as e,P as y,Y as q,K as b,O as k,aq as $,aV as H,al as A,L as V,c as L,q as T,R as M,Q as E,ac as O,C}from"./vue-vendor-Bsazo-x0.js";import{C as F}from"./ConfirmModal-htOonKjA.js";import"./element-plus-CqiD73Lu.js";import"./vendor-Dr8jvgFu.js";const K={key:0,class:"fixed inset-0 z-50 h-full w-full overflow-y-auto bg-gray-900/60"},Q={class:"relative top-10 mx-auto w-full max-w-2xl rounded-lg bg-white shadow dark:bg-gray-800"},R={class:"flex items-center justify-between border-b px-6 py-4 dark:border-gray-700"},Y={class:"text-lg font-semibold text-gray-900 dark:text-white"},G={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},I={class:"flex items-center space-x-6"},J={class:"flex items-center space-x-2"},W={class:"flex items-center space-x-2"},X={class:"flex items-center justify-end space-x-3 pt-2"},Z=["disabled"],ee={key:0,class:"-ml-1 mr-2 h-4 w-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},te={key:1},se={__name:"AnnouncementModal",props:{show:{type:Boolean,default:!1},announcement:{type:Object,default:null}},emits:["close","saved"],setup(f,{emit:g}){const n=f,c=g,m=x(!1),s=N({title:"",content:"",type:"normal",isPinned:!1,isActive:!0});U(()=>n.show,l=>{l&&n.announcement?(s.title=n.announcement.title||"",s.content=n.announcement.content||"",s.type=n.announcement.type||"normal",s.isPinned=n.announcement.isPinned||!1,s.isActive=n.announcement.isActive!==void 0?n.announcement.isActive:!0):l&&!n.announcement&&(s.title="",s.content="",s.type="normal",s.isPinned=!1,s.isActive=!0)},{immediate:!0});async function v(){var l,t;if(!s.title||!s.content){p("标题和内容不能为空","error");return}m.value=!0;try{n.announcement?(await h.put(`/admin/announcements/${n.announcement.id}`,s),p("公告更新成功","success")):(await h.post("/admin/announcements",s),p("公告创建成功","success")),c("saved"),c("close")}catch(o){p(((t=(l=o.response)==null?void 0:l.data)==null?void 0:t.message)||"操作失败","error")}finally{m.value=!1}}return(l,t)=>f.show?(u(),d("div",K,[e("div",Q,[e("div",R,[e("h3",Y,y(f.announcement?"编辑公告":"创建公告"),1),e("button",{class:"text-gray-400 hover:text-gray-600",onClick:t[0]||(t[0]=o=>c("close"))},t[7]||(t[7]=[e("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M6 18L18 6M6 6l12 12","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)]))]),e("form",{class:"space-y-4 px-6 py-5",onSubmit:q(v,["prevent"])},[e("div",null,[t[8]||(t[8]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},[k(" 标题 "),e("span",{class:"text-red-500"},"*")],-1)),b(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>s.title=o),class:"block w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",placeholder:"请输入标题",required:""},null,512),[[$,s.title,void 0,{trim:!0}]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},[k(" 内容 "),e("span",{class:"text-red-500"},"*")],-1)),b(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=o=>s.content=o),class:"block w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",placeholder:"请输入内容（支持Markdown）",required:"",rows:"8"},null,512),[[$,s.content,void 0,{trim:!0}]])]),e("div",G,[e("div",null,[t[11]||(t[11]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 类型 ",-1)),b(e("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>s.type=o),class:"block w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm"},t[10]||(t[10]=[e("option",{value:"normal"},"普通",-1),e("option",{value:"important"},"重要",-1)]),512),[[H,s.type]])])]),e("div",I,[e("div",J,[b(e("input",{id:"isPinned","onUpdate:modelValue":t[4]||(t[4]=o=>s.isPinned=o),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500",type:"checkbox"},null,512),[[A,s.isPinned]]),t[12]||(t[12]=e("label",{class:"text-sm text-gray-700 dark:text-gray-300",for:"isPinned"},"置顶",-1))]),e("div",W,[b(e("input",{id:"isActive","onUpdate:modelValue":t[5]||(t[5]=o=>s.isActive=o),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500",type:"checkbox"},null,512),[[A,s.isActive]]),t[13]||(t[13]=e("label",{class:"text-sm text-gray-700 dark:text-gray-300",for:"isActive"},"启用",-1))])]),e("div",X,[e("button",{class:"rounded-md border px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-gray-700",type:"button",onClick:t[6]||(t[6]=o=>c("close"))}," 取消 "),e("button",{class:"inline-flex items-center rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow hover:bg-blue-700 disabled:opacity-50",disabled:m.value,type:"submit"},[m.value?(u(),d("svg",ee,t[14]||(t[14]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",fill:"currentColor"},null,-1)]))):V("",!0),k(" "+y(f.announcement?"更新":"创建"),1)],8,Z)])],32)])])):(u(),d("div",te))}},re={class:"space-y-6"},ne={class:"sm:flex sm:items-center"},oe={class:"mt-4 space-x-3 sm:ml-16 sm:mt-0 sm:flex-none"},ae=["disabled"],le=["disabled"],ie={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},de={key:0,class:"p-8 text-center"},ue={key:1,class:"p-8 text-center"},ce={key:2,class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},me={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-800"},xe={class:"whitespace-nowrap px-6 py-4"},ge={class:"flex items-center"},pe={key:0,class:"mr-2 text-yellow-500"},ye={class:"whitespace-nowrap px-6 py-4"},fe={class:"whitespace-nowrap px-6 py-4"},ve={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500 dark:text-gray-400"},be={class:"whitespace-nowrap px-6 py-4 text-right text-sm font-medium"},ke=["onClick"],we=["onClick"],Me={__name:"AnnouncementManagementView",setup(f){const g=x(!0),n=x([]),c=x(!1),m=x(!1),s=x(!1),v=x(null),l=x(null),t=L(()=>n.value);function o(i){return i?new Date(i).toLocaleString("zh-CN"):"-"}async function w(){g.value=!0;try{const i=await h.get("/admin/announcements");i.success?n.value=i.data||[]:n.value=[]}catch{p("加载公告失败","error"),n.value=[]}finally{g.value=!1}}function P(i){v.value=i,m.value=!0}function B(i){l.value=i,s.value=!0}async function j(){if(l.value)try{await h.delete(`/admin/announcements/${l.value.id}`),p("删除成功","success"),s.value=!1,l.value=null,await w()}catch{p("删除失败","error")}}function z(){c.value=!1,m.value=!1,v.value=null}function D(){w()}return T(()=>{w()}),(i,r)=>{var _;return u(),d("div",re,[e("div",ne,[r[4]||(r[4]=e("div",{class:"sm:flex-auto"},[e("h1",{class:"text-2xl font-semibold text-gray-900 dark:text-white"},"公告管理"),e("p",{class:"mt-2 text-sm text-gray-700 dark:text-gray-300"},"管理系统公告")],-1)),e("div",oe,[e("button",{class:"inline-flex items-center justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",disabled:g.value,onClick:r[0]||(r[0]=a=>c.value=!0)},r[2]||(r[2]=[e("svg",{class:"-ml-1 mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 4v16m8-8H4","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1),k(" 创建公告 ",-1)]),8,ae),e("button",{class:"inline-flex items-center justify-center rounded-md border border-transparent bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600",disabled:g.value,onClick:w},r[3]||(r[3]=[e("svg",{class:"-ml-1 mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1),k(" 刷新 ",-1)]),8,le)])]),e("div",ie,[g.value?(u(),d("div",de,r[5]||(r[5]=[e("svg",{class:"mx-auto h-8 w-8 animate-spin text-blue-500",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",fill:"currentColor"})],-1),e("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"},"加载中...",-1)]))):t.value.length===0?(u(),d("div",ue,r[6]||(r[6]=[e("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"暂无公告",-1)]))):(u(),d("table",ce,[r[7]||(r[7]=e("thead",{class:"bg-gray-50 dark:bg-gray-900"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400",scope:"col"}," 标题 "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400",scope:"col"}," 类型 "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400",scope:"col"}," 状态 "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400",scope:"col"}," 创建时间 "),e("th",{class:"px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400",scope:"col"}," 操作 ")])],-1)),e("tbody",me,[(u(!0),d(E,null,O(t.value,a=>(u(),d("tr",{key:a.id},[e("td",xe,[e("div",ge,[a.isPinned?(u(),d("span",pe,"📌")):V("",!0),e("span",{class:C(["text-sm font-medium text-gray-900 dark:text-white",{"text-red-600 dark:text-red-400":a.type==="important"}])},y(a.title),3)])]),e("td",ye,[e("span",{class:C(["inline-flex rounded-full px-2 py-1 text-xs font-semibold",a.type==="important"?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"])},y(a.type==="important"?"重要":"普通"),3)]),e("td",fe,[e("span",{class:C(["inline-flex rounded-full px-2 py-1 text-xs font-semibold",a.isActive?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"])},y(a.isActive?"启用":"禁用"),3)]),e("td",ve,y(o(a.createdAt)),1),e("td",be,[e("button",{class:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300",onClick:S=>P(a)}," 编辑 ",8,ke),e("button",{class:"ml-4 text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",onClick:S=>B(a)}," 删除 ",8,we)])]))),128))])]))]),M(se,{announcement:v.value,show:c.value||m.value,onClose:z,onSaved:D},null,8,["announcement","show"]),M(F,{"confirm-class":"bg-red-600 hover:bg-red-700","confirm-text":"删除",message:`确定要删除公告「${(_=l.value)==null?void 0:_.title}」吗？`,show:s.value,title:"确认删除",onCancel:r[1]||(r[1]=a=>s.value=!1),onConfirm:j},null,8,["message","show"])])}}};export{Me as default};
