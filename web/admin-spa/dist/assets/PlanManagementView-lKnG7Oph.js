import{c as w,s as $}from"./index-CXU7wAgK.js";import{r as L,c as U,o as F,I as j,y as d,z as e,P as p,C as V,Y as O,x as u,L as g,K as n,O as v,aq as m,an as q,Q as R,aV as P,a5 as K,q as T,ac as S}from"./vue-vendor-Bsazo-x0.js";import{u as W}from"./useConfirm-hZGjIXMC.js";import"./element-plus-CqiD73Lu.js";import"./vendor-Dr8jvgFu.js";const z={class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4"},B={class:"max-h-[90vh] w-full max-w-4xl overflow-y-auto rounded-lg bg-white shadow-xl dark:bg-gray-800"},E={class:"sticky top-0 z-10 flex items-center justify-between border-b border-gray-200 bg-white p-4 dark:border-gray-700 dark:bg-gray-800"},N={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},G={class:"border-b border-gray-200 bg-gray-50 px-4 py-3 dark:border-gray-700 dark:bg-gray-900"},Q={class:"flex items-center justify-center space-x-4"},Y={class:"flex items-center"},H={class:"flex items-center"},J={class:"flex items-center"},X={key:0,class:"space-y-4"},Z={class:"flex gap-4"},_={class:"flex cursor-pointer items-center"},ee={class:"flex cursor-pointer items-center"},te={class:"mt-1 text-xs text-gray-500"},le={class:"mt-1 text-xs text-gray-500"},ae={key:1,class:"space-y-4"},se={class:"rounded-lg border border-blue-200 bg-blue-50 p-3 dark:border-blue-700 dark:bg-blue-900/20"},re={class:"grid grid-cols-1 gap-2 lg:grid-cols-3"},oe={key:2,class:"space-y-4"},ie={class:"mt-6 flex justify-between"},de={key:1},ne={class:"flex gap-3"},ue=["disabled"],me=["disabled"],ye={__name:"CreatePlanModal",props:{plan:{type:Object,default:null}},emits:["close","success"],setup(h,{emit:M}){const x=h,A=M,f=L(!1),y=L(1),c=U(()=>!!x.plan),s=L({name:"",type:"monthly",price:0,duration:30,dailyLimitActual:0,dailyLimitDisplay:0,totalLimitActual:0,totalLimitDisplay:0,description:"",xianyuLink:""}),a=L({name:"",dailyCostLimit:0,totalCostLimit:0,weeklyOpusCostLimit:0,concurrencyLimit:0,rateLimitWindow:null,rateLimitRequests:null,rateLimitCost:null,permissions:"all",claudeAccountId:"",geminiAccountId:"",openaiAccountId:"",bedrockAccountId:"",droidAccountId:"",enableModelRestriction:!1,restrictedModels:[],enableClientRestriction:!1,allowedClients:[],tags:[],description:""}),I=U(()=>{if(s.value.type==="monthly"){const r=parseFloat(s.value.dailyLimitActual)||0,t=parseFloat(s.value.dailyLimitDisplay)||0;return!r||r===0?1:t/r}else{const r=parseFloat(s.value.totalLimitActual)||0,t=parseFloat(s.value.totalLimitDisplay)||0;return!r||r===0?1:t/r}}),D=()=>{s.value.type==="monthly"?(s.value.totalLimitActual=0,s.value.totalLimitDisplay=0):(s.value.duration=30,s.value.dailyLimitActual=0,s.value.dailyLimitDisplay=0)},b=()=>{y.value<3&&y.value++},i=async()=>{f.value=!0;try{const r={name:a.value.name,planId:c.value?x.plan.id:"",dailyCostLimit:a.value.dailyCostLimit||0,totalCostLimit:a.value.totalCostLimit||0,weeklyOpusCostLimit:a.value.weeklyOpusCostLimit||0,concurrencyLimit:a.value.concurrencyLimit||0,rateLimitWindow:a.value.rateLimitWindow||null,rateLimitRequests:a.value.rateLimitRequests||null,rateLimitCost:a.value.rateLimitCost||null,permissions:a.value.permissions||"all",claudeAccountId:a.value.claudeAccountId||"",geminiAccountId:a.value.geminiAccountId||"",openaiAccountId:a.value.openaiAccountId||"",bedrockAccountId:a.value.bedrockAccountId||"",droidAccountId:a.value.droidAccountId||"",enableModelRestriction:a.value.enableModelRestriction||!1,restrictedModels:a.value.restrictedModels||[],enableClientRestriction:a.value.enableClientRestriction||!1,allowedClients:a.value.allowedClients||[],tags:a.value.tags||[],description:a.value.description||""};let t;if(c.value&&x.plan.apiKeyTemplateId){const C=await w.put(`/admin/api-key-templates/${x.plan.apiKeyTemplateId}`,r);if(!C||!C.success)throw new Error("更新 API Key 模板失败");t=x.plan.apiKeyTemplateId}else{const C=await w.post("/admin/api-key-templates",r);if(!C||!C.success)throw new Error("创建 API Key 模板失败");t=C.data.id}const l={...s.value,apiKeyTemplateId:t};let k;if(c.value?k=await w.put(`/admin/plans/${x.plan.id}`,l):k=await w.post("/admin/plans",l),k&&k.success)c.value||await w.put(`/admin/api-key-templates/${t}`,{planId:k.data.id}),$(c.value?"套餐更新成功":"套餐创建成功","success"),A("success");else throw new Error((k==null?void 0:k.error)||"操作失败")}catch(r){$(r.message||"操作失败","error"),console.error("Failed to create/update plan:",r)}finally{f.value=!1}},o=async r=>{try{const t=await w.get(`/admin/api-key-templates/${r}`);if(t&&t.success&&t.data){const l=t.data;a.value={name:l.name||"",dailyCostLimit:l.dailyCostLimit||0,totalCostLimit:l.totalCostLimit||0,weeklyOpusCostLimit:l.weeklyOpusCostLimit||0,concurrencyLimit:l.concurrencyLimit||0,rateLimitWindow:l.rateLimitWindow||null,rateLimitRequests:l.rateLimitRequests||null,rateLimitCost:l.rateLimitCost||null,permissions:l.permissions||"all",claudeAccountId:l.claudeAccountId||"",geminiAccountId:l.geminiAccountId||"",openaiAccountId:l.openaiAccountId||"",bedrockAccountId:l.bedrockAccountId||"",droidAccountId:l.droidAccountId||"",enableModelRestriction:l.enableModelRestriction||!1,restrictedModels:l.restrictedModels||[],enableClientRestriction:l.enableClientRestriction||!1,allowedClients:l.allowedClients||[],tags:l.tags||[],description:l.description||""}}}catch(t){console.error("Failed to load template data:",t)}};return F(()=>x.plan,async r=>{r?(s.value={name:r.name||"",type:r.type||"monthly",price:parseFloat(r.price)||0,duration:parseInt(r.duration)||30,dailyLimitActual:parseFloat(r.dailyLimitActual)||0,dailyLimitDisplay:parseFloat(r.dailyLimitDisplay)||0,totalLimitActual:parseFloat(r.totalLimitActual)||0,totalLimitDisplay:parseFloat(r.totalLimitDisplay)||0,description:r.description||"",xianyuLink:r.xianyuLink||""},r.apiKeyTemplateId&&await o(r.apiKeyTemplateId)):a.value={name:"",dailyCostLimit:0,totalCostLimit:0,weeklyOpusCostLimit:0,concurrencyLimit:0,rateLimitWindow:null,rateLimitRequests:null,rateLimitCost:null,permissions:"all",claudeAccountId:"",geminiAccountId:"",openaiAccountId:"",bedrockAccountId:"",droidAccountId:"",enableModelRestriction:!1,restrictedModels:[],enableClientRestriction:!1,allowedClients:[],tags:[],description:""}},{immediate:!0}),(r,t)=>(d(),j(K,{to:"body"},[e("div",z,[e("div",B,[e("div",E,[e("h3",N,p(c.value?"编辑套餐":"创建套餐"),1),e("button",{class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",onClick:t[0]||(t[0]=l=>r.$emit("close"))},t[24]||(t[24]=[e("i",{class:"fas fa-times"},null,-1)]))]),e("div",G,[e("div",Q,[e("div",Y,[e("div",{class:V(["flex h-8 w-8 items-center justify-center rounded-full text-sm font-semibold",y.value>=1?"bg-blue-500 text-white":"bg-gray-200 text-gray-500 dark:bg-gray-700 dark:text-gray-400"])}," 1 ",2),t[25]||(t[25]=e("span",{class:"ml-2 text-sm font-medium text-gray-700 dark:text-gray-300"},"套餐信息",-1))]),t[28]||(t[28]=e("div",{class:"h-0.5 w-8 bg-gray-300 dark:bg-gray-600"},null,-1)),e("div",H,[e("div",{class:V(["flex h-8 w-8 items-center justify-center rounded-full text-sm font-semibold",y.value>=2?"bg-blue-500 text-white":"bg-gray-200 text-gray-500 dark:bg-gray-700 dark:text-gray-400"])}," 2 ",2),t[26]||(t[26]=e("span",{class:"ml-2 text-sm font-medium text-gray-700 dark:text-gray-300"},"API Key 模板",-1))]),t[29]||(t[29]=e("div",{class:"h-0.5 w-8 bg-gray-300 dark:bg-gray-600"},null,-1)),e("div",J,[e("div",{class:V(["flex h-8 w-8 items-center justify-center rounded-full text-sm font-semibold",y.value>=3?"bg-blue-500 text-white":"bg-gray-200 text-gray-500 dark:bg-gray-700 dark:text-gray-400"])}," 3 ",2),t[27]||(t[27]=e("span",{class:"ml-2 text-sm font-medium text-gray-700 dark:text-gray-300"},"闲鱼链接",-1))])])]),e("form",{class:"p-6",onSubmit:O(i,["prevent"])},[y.value===1?(d(),u("div",X,[e("div",null,[t[30]||(t[30]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},[v(" 套餐名称 "),e("span",{class:"text-red-500"},"*")],-1)),n(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>s.value.name=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"输入套餐名称",required:""},null,512),[[m,s.value.name]])]),e("div",null,[t[33]||(t[33]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},[v(" 套餐类型 "),e("span",{class:"text-red-500"},"*")],-1)),e("div",Z,[e("label",_,[n(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>s.value.type=l),class:"mr-2 text-blue-600",type:"radio",value:"monthly",onChange:D},null,544),[[q,s.value.type]]),t[31]||(t[31]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"月卡",-1))]),e("label",ee,[n(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>s.value.type=l),class:"mr-2 text-blue-600",type:"radio",value:"usage",onChange:D},null,544),[[q,s.value.type]]),t[32]||(t[32]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"计量",-1))])])]),e("div",null,[t[34]||(t[34]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},[v(" 价格（人民币） "),e("span",{class:"text-red-500"},"*")],-1)),n(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>s.value.price=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"0",placeholder:"输入价格",required:"",step:"0.01",type:"number"},null,512),[[m,s.value.price,void 0,{number:!0}]])]),s.value.type==="monthly"?(d(),u(R,{key:0},[e("div",null,[t[35]||(t[35]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},[v(" 时长（天数） "),e("span",{class:"text-red-500"},"*")],-1)),n(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>s.value.duration=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"1",placeholder:"输入天数",required:"",type:"number"},null,512),[[m,s.value.duration,void 0,{number:!0}]])]),e("div",null,[t[36]||(t[36]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},[v(" 每日额度（实际，美元） "),e("span",{class:"text-red-500"},"*")],-1)),n(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>s.value.dailyLimitActual=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"0",placeholder:"输入实际每日额度",required:"",step:"0.01",type:"number"},null,512),[[m,s.value.dailyLimitActual,void 0,{number:!0}]])]),e("div",null,[t[37]||(t[37]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},[v(" 每日额度（显示给用户，美元） "),e("span",{class:"text-red-500"},"*")],-1)),n(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>s.value.dailyLimitDisplay=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"0",placeholder:"输入显示给用户的每日额度",required:"",step:"0.01",type:"number"},null,512),[[m,s.value.dailyLimitDisplay,void 0,{number:!0}]]),e("p",te," 倍速将自动计算："+p(I.value.toFixed(2))+"x ",1)]),e("div",null,[t[38]||(t[38]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 描述 ",-1)),n(e("textarea",{"onUpdate:modelValue":t[8]||(t[8]=l=>s.value.description=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"输入套餐描述（可选）",rows:"3"},null,512),[[m,s.value.description]])])],64)):g("",!0),s.value.type==="usage"?(d(),u(R,{key:1},[e("div",null,[t[39]||(t[39]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},[v(" 总额度（实际，美元） "),e("span",{class:"text-red-500"},"*")],-1)),n(e("input",{"onUpdate:modelValue":t[9]||(t[9]=l=>s.value.totalLimitActual=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"0",placeholder:"输入实际总额度",required:"",step:"0.01",type:"number"},null,512),[[m,s.value.totalLimitActual,void 0,{number:!0}]])]),e("div",null,[t[40]||(t[40]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},[v(" 总额度（显示给用户，美元） "),e("span",{class:"text-red-500"},"*")],-1)),n(e("input",{"onUpdate:modelValue":t[10]||(t[10]=l=>s.value.totalLimitDisplay=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"0",placeholder:"输入显示给用户的总额度",required:"",step:"0.01",type:"number"},null,512),[[m,s.value.totalLimitDisplay,void 0,{number:!0}]]),e("p",le," 倍速将自动计算："+p(I.value.toFixed(2))+"x ",1)])],64)):g("",!0)])):g("",!0),y.value===2?(d(),u("div",ae,[t[54]||(t[54]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," 配置 API Key 模板，这些配置将在激活订单时应用到生成的 API Key ",-1)),e("div",null,[t[41]||(t[41]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},[v(" 模板名称 "),e("span",{class:"text-red-500"},"*")],-1)),n(e("input",{"onUpdate:modelValue":t[11]||(t[11]=l=>a.value.name=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"输入模板名称",required:""},null,512),[[m,a.value.name]])]),e("div",null,[t[42]||(t[42]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 每日费用限额（美元） ",-1)),n(e("input",{"onUpdate:modelValue":t[12]||(t[12]=l=>a.value.dailyCostLimit=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"0",placeholder:"输入每日费用限额（0表示无限制）",step:"0.01",type:"number"},null,512),[[m,a.value.dailyCostLimit,void 0,{number:!0}]])]),e("div",null,[t[43]||(t[43]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 总费用限额（美元） ",-1)),n(e("input",{"onUpdate:modelValue":t[13]||(t[13]=l=>a.value.totalCostLimit=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"0",placeholder:"输入总费用限额（0表示无限制）",step:"0.01",type:"number"},null,512),[[m,a.value.totalCostLimit,void 0,{number:!0}]])]),e("div",null,[t[44]||(t[44]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 并发限制 ",-1)),n(e("input",{"onUpdate:modelValue":t[14]||(t[14]=l=>a.value.concurrencyLimit=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"0",placeholder:"输入并发限制（0表示无限制）",type:"number"},null,512),[[m,a.value.concurrencyLimit,void 0,{number:!0}]])]),e("div",se,[t[48]||(t[48]=e("h4",{class:"mb-2 text-sm font-semibold text-gray-800 dark:text-gray-200"}," 速率限制设置（可选） ",-1)),e("div",re,[e("div",null,[t[45]||(t[45]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"}," 时间窗口（分钟） ",-1)),n(e("input",{"onUpdate:modelValue":t[15]||(t[15]=l=>a.value.rateLimitWindow=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"1",placeholder:"无限制",type:"number"},null,512),[[m,a.value.rateLimitWindow,void 0,{number:!0}]])]),e("div",null,[t[46]||(t[46]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"}," 请求次数限制 ",-1)),n(e("input",{"onUpdate:modelValue":t[16]||(t[16]=l=>a.value.rateLimitRequests=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"1",placeholder:"无限制",type:"number"},null,512),[[m,a.value.rateLimitRequests,void 0,{number:!0}]])]),e("div",null,[t[47]||(t[47]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"}," 费用限制（美元） ",-1)),n(e("input",{"onUpdate:modelValue":t[17]||(t[17]=l=>a.value.rateLimitCost=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"0",placeholder:"无限制",step:"0.01",type:"number"},null,512),[[m,a.value.rateLimitCost,void 0,{number:!0}]])])])]),e("div",null,[t[49]||(t[49]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Opus 模型周费用限制（美元） ",-1)),n(e("input",{"onUpdate:modelValue":t[18]||(t[18]=l=>a.value.weeklyOpusCostLimit=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"0",placeholder:"输入 Opus 周费用限制（0表示无限制）",step:"0.01",type:"number"},null,512),[[m,a.value.weeklyOpusCostLimit,void 0,{number:!0}]]),t[50]||(t[50]=e("p",{class:"mt-1 text-xs text-gray-500"}," 设置 Opus 模型的周费用限制（周一到周日），仅限 Claude 官方账户 ",-1))]),e("div",null,[t[52]||(t[52]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 权限 ",-1)),n(e("select",{"onUpdate:modelValue":t[19]||(t[19]=l=>a.value.permissions=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white"},t[51]||(t[51]=[e("option",{value:"all"},"全部",-1),e("option",{value:"claude"},"仅 Claude",-1),e("option",{value:"gemini"},"仅 Gemini",-1),e("option",{value:"openai"},"仅 OpenAI",-1),e("option",{value:"droid"},"仅 Droid",-1)]),512),[[P,a.value.permissions]])]),e("div",null,[t[53]||(t[53]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 描述 ",-1)),n(e("textarea",{"onUpdate:modelValue":t[20]||(t[20]=l=>a.value.description=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"输入模板描述（可选）",rows:"3"},null,512),[[m,a.value.description]])])])):g("",!0),y.value===3?(d(),u("div",oe,[e("div",null,[t[55]||(t[55]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},[v(" 闲鱼链接 "),e("span",{class:"text-red-500"},"*")],-1)),n(e("input",{"onUpdate:modelValue":t[21]||(t[21]=l=>s.value.xianyuLink=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"输入闲鱼商品链接",required:"",type:"url"},null,512),[[m,s.value.xianyuLink]]),t[56]||(t[56]=e("p",{class:"mt-1 text-xs text-gray-500"},"用户点击购买时将跳转到此链接",-1))])])):g("",!0),e("div",ie,[y.value>1?(d(),u("button",{key:0,class:"rounded-lg bg-gray-100 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-200 dark:bg-gray-600 dark:text-gray-300 dark:hover:bg-gray-500",type:"button",onClick:t[22]||(t[22]=l=>y.value--)}," 上一步 ")):(d(),u("div",de)),e("div",ne,[e("button",{class:"rounded-lg bg-gray-100 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-200 dark:bg-gray-600 dark:text-gray-300 dark:hover:bg-gray-500",type:"button",onClick:t[23]||(t[23]=l=>r.$emit("close"))}," 取消 "),y.value<3?(d(),u("button",{key:0,class:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50",disabled:f.value,type:"button",onClick:b}," 下一步 ",8,ue)):(d(),u("button",{key:1,class:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50",disabled:f.value,type:"submit"},p(f.value?"创建中...":c.value?"更新":"创建"),9,me))])])],32)])])]))}},pe={class:"tab-content"},be={class:"card p-4 sm:p-6"},ge={class:"mb-4 flex flex-col gap-4 sm:mb-6 sm:flex-row sm:items-center sm:justify-between"},xe={key:0,class:"flex justify-center py-8"},ce={key:1,class:"py-8 text-center text-gray-500"},ve={key:2,class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3"},fe={class:"mb-3 flex items-start justify-between"},ke={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},we={class:"flex items-center gap-2"},Le={class:"text-xs text-gray-500"},Ce={class:"mb-3 space-y-1 text-sm text-gray-600 dark:text-gray-400"},Ae={class:"flex justify-between"},Ie={class:"font-semibold text-gray-900 dark:text-gray-100"},$e={key:0,class:"flex justify-between"},Ve={class:"font-semibold text-gray-900 dark:text-gray-100"},De={key:1,class:"flex justify-between"},Me={class:"font-semibold text-gray-900 dark:text-gray-100"},Re={key:2,class:"flex justify-between"},he={class:"font-semibold text-gray-900 dark:text-gray-100"},Ue={key:3,class:"flex justify-between"},qe={class:"font-semibold text-gray-900 dark:text-gray-100"},je={key:4,class:"flex justify-between"},Fe={class:"font-semibold text-gray-900 dark:text-gray-100"},Oe={key:5,class:"flex justify-between"},Pe={class:"font-semibold text-gray-900 dark:text-gray-100"},Ke={class:"mt-4 flex gap-2"},Te=["onClick"],Se=["onClick"],Ge={__name:"PlanManagementView",setup(h){const{showConfirm:M}=W(),x=L(!1),A=L([]),f=L(!1),y=L(null),c=async()=>{x.value=!0;try{const b=await w.get("/admin/plans?includeInactive=true");b&&b.success&&(A.value=b.data||[])}catch(b){$("加载套餐列表失败","error"),console.error("Failed to load plans:",b)}finally{x.value=!1}},s=b=>{y.value=b},a=async b=>{if(await M({title:"确认删除",message:"确定要删除这个套餐吗？此操作不可恢复。"}))try{const o=await w.delete(`/admin/plans/${b}`);o&&o.success&&($("套餐删除成功","success"),await c())}catch(o){$("删除套餐失败","error"),console.error("Failed to delete plan:",o)}},I=()=>{f.value=!1,y.value=null},D=()=>{I(),c()};return T(()=>{c()}),(b,i)=>(d(),u("div",pe,[e("div",be,[e("div",ge,[i[2]||(i[2]=e("div",null,[e("h3",{class:"mb-1 text-lg font-bold text-gray-900 dark:text-gray-100 sm:mb-2 sm:text-xl"}," 套餐管理 "),e("p",{class:"text-sm text-gray-600 dark:text-gray-400 sm:text-base"},"管理套餐配置和定价")],-1)),e("button",{class:"btn btn-primary flex items-center gap-2 px-4 py-2 text-sm font-medium",onClick:i[0]||(i[0]=o=>f.value=!0)},i[1]||(i[1]=[e("i",{class:"fas fa-plus"},null,-1),v(" 创建套餐 ",-1)]))]),x.value?(d(),u("div",xe,i[3]||(i[3]=[e("div",{class:"loading-spinner"},null,-1)]))):A.value.length===0?(d(),u("div",ce,' 暂无套餐，点击"创建套餐"开始 ')):(d(),u("div",ve,[(d(!0),u(R,null,S(A.value,o=>(d(),u("div",{key:o.id,class:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800"},[e("div",fe,[e("div",null,[e("h4",ke,p(o.name),1),e("span",{class:V(["mt-1 inline-block rounded-full px-2 py-0.5 text-xs font-medium",o.type==="monthly"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200"])},p(o.type==="monthly"?"月卡":"计量"),3)]),e("div",we,[e("span",{class:V(["h-2 w-2 rounded-full",o.isActive?"bg-green-500":"bg-gray-400"])},null,2),e("span",Le,p(o.isActive?"启用":"禁用"),1)])]),e("div",Ce,[e("div",Ae,[i[4]||(i[4]=e("span",null,"价格：",-1)),e("span",Ie," ¥"+p(o.price),1)]),o.type==="monthly"?(d(),u("div",$e,[i[5]||(i[5]=e("span",null,"每日额度（显示）：",-1)),e("span",Ve," $"+p(o.dailyLimitDisplay),1)])):g("",!0),o.type==="monthly"?(d(),u("div",De,[i[6]||(i[6]=e("span",null,"每日额度（实际）：",-1)),e("span",Me," $"+p(o.dailyLimitActual),1)])):g("",!0),o.type==="monthly"?(d(),u("div",Re,[i[7]||(i[7]=e("span",null,"倍速：",-1)),e("span",he,p(o.speedMultiplier)+"x ",1)])):g("",!0),o.type==="usage"?(d(),u("div",Ue,[i[8]||(i[8]=e("span",null,"总额度（显示）：",-1)),e("span",qe," $"+p(o.totalLimitDisplay),1)])):g("",!0),o.type==="usage"?(d(),u("div",je,[i[9]||(i[9]=e("span",null,"总额度（实际）：",-1)),e("span",Fe," $"+p(o.totalLimitActual),1)])):g("",!0),o.type==="usage"?(d(),u("div",Oe,[i[10]||(i[10]=e("span",null,"倍速：",-1)),e("span",Pe,p(o.speedMultiplier)+"x ",1)])):g("",!0)]),e("div",Ke,[e("button",{class:"flex-1 rounded-lg bg-blue-100 px-3 py-1.5 text-sm font-medium text-blue-700 hover:bg-blue-200 dark:bg-blue-900 dark:text-blue-200 dark:hover:bg-blue-800",onClick:r=>s(o)}," 编辑 ",8,Te),e("button",{class:"flex-1 rounded-lg bg-red-100 px-3 py-1.5 text-sm font-medium text-red-700 hover:bg-red-200 dark:bg-red-900 dark:text-red-200 dark:hover:bg-red-800",onClick:r=>a(o.id)}," 删除 ",8,Se)])]))),128))]))]),f.value||y.value?(d(),j(ye,{key:0,plan:y.value,onClose:I,onSuccess:D},null,8,["plan"])):g("",!0)]))}};export{Ge as default};
