import{r as p,o as Q,x as n,L as A,y as u,z as e,P as d,K as M,aV as O,Q as E,ac as Y,C as V,Y as te,an as Z,O as q,_ as le,aq as R,al as re,c as se,q as oe,R as H,u as ee}from"./vue-vendor-Bsazo-x0.js";import{_ as J,c as B,s as j}from"./index-BOJkUMy5.js";import{C as ae}from"./ConfirmModal-CH--Oo2R.js";import{d as de}from"./vendor-Dr8jvgFu.js";import"./element-plus-CqiD73Lu.js";const ie={key:0,class:"fixed inset-0 z-50 h-full w-full overflow-y-auto bg-gray-600 bg-opacity-50"},ne={class:"relative top-10 mx-auto w-4/5 max-w-4xl rounded-md border bg-white p-5 shadow-lg"},ue={class:"mt-3"},ce={class:"mb-6 flex items-center justify-between"},xe={class:"text-lg font-medium text-gray-900"},me={class:"text-sm text-gray-500"},ge={class:"mb-6"},ve={key:0,class:"py-12 text-center"},ye={key:1,class:"space-y-6"},pe={class:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4"},fe={class:"overflow-hidden rounded-lg bg-blue-50 shadow"},be={class:"p-5"},ke={class:"flex items-center"},he={class:"ml-5 w-0 flex-1"},we={class:"text-lg font-medium text-blue-900"},$e={class:"overflow-hidden rounded-lg bg-green-50 shadow"},_e={class:"p-5"},Ce={class:"flex items-center"},Me={class:"ml-5 w-0 flex-1"},Ae={class:"text-lg font-medium text-green-900"},Ue={class:"overflow-hidden rounded-lg bg-purple-50 shadow"},je={class:"p-5"},ze={class:"flex items-center"},Ve={class:"ml-5 w-0 flex-1"},Be={class:"text-lg font-medium text-purple-900"},Le={class:"overflow-hidden rounded-lg bg-yellow-50 shadow"},Se={class:"p-5"},Ie={class:"flex items-center"},Te={class:"ml-5 w-0 flex-1"},Ne={class:"text-lg font-medium text-yellow-900"},Ke={key:0,class:"rounded-lg border border-gray-200 bg-white"},Pe={class:"overflow-hidden"},De={class:"min-w-full divide-y divide-gray-200"},Fe={class:"divide-y divide-gray-200 bg-white"},Re={class:"whitespace-nowrap px-6 py-4"},qe={class:"text-sm font-medium text-gray-900"},He={class:"text-sm text-gray-500"},Oe={class:"whitespace-nowrap px-6 py-4"},Qe={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-900"},Ee={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-900"},Ye={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-900"},Ge={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},Je={class:"rounded-lg border border-gray-200 bg-white"},We={class:"p-6"},Xe={class:"flex h-64 items-center justify-center rounded-lg border-2 border-dashed border-gray-300"},Ze={class:"text-center"},et={class:"mt-1 text-sm text-gray-500"},tt={key:1,class:"py-12 text-center"},st={class:"mt-6 flex justify-end"},ot={__name:"UserUsageStatsModal",props:{show:{type:Boolean,default:!1},user:{type:Object,default:null}},emits:["close"],setup(f,{emit:_}){const g=f,$=_,i=p(!1),y=p("week"),m=p(null),r=p(null),a=b=>b>=1e6?(b/1e6).toFixed(1)+"M":b>=1e3?(b/1e3).toFixed(1)+"K":b.toString(),c=b=>b?new Date(b).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):null,k=async()=>{if(g.user){i.value=!0;try{const[b,l]=await Promise.all([B.get(`/users/${g.user.id}/usage-stats`,{params:{period:y.value}}),B.get(`/users/${g.user.id}`)]);b.success&&(m.value=b.stats),l.success&&(r.value=l.user)}catch(b){console.error("Failed to load user usage stats:",b),j("Failed to load usage statistics","error")}finally{i.value=!1}}};return Q([()=>g.show,()=>g.user],([b,l])=>{b&&l&&k()}),(b,l)=>{var U,S,I,v,o,C,T,N,K,P;return f.show?(u(),n("div",ie,[e("div",ne,[e("div",ue,[e("div",ce,[e("div",null,[e("h3",xe," Usage Statistics - "+d(((U=f.user)==null?void 0:U.displayName)||((S=f.user)==null?void 0:S.username)),1),e("p",me,"@"+d((I=f.user)==null?void 0:I.username)+" • "+d((v=f.user)==null?void 0:v.role),1)]),e("button",{class:"text-gray-400 hover:text-gray-600",onClick:l[0]||(l[0]=h=>$("close"))},l[3]||(l[3]=[e("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M6 18L18 6M6 6l12 12","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)]))]),e("div",ge,[M(e("select",{"onUpdate:modelValue":l[1]||(l[1]=h=>y.value=h),class:"block w-32 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",onChange:k},l[4]||(l[4]=[e("option",{value:"day"},"Last 24 Hours",-1),e("option",{value:"week"},"Last 7 Days",-1),e("option",{value:"month"},"Last 30 Days",-1),e("option",{value:"quarter"},"Last 90 Days",-1)]),544),[[O,y.value]])]),i.value?(u(),n("div",ve,l[5]||(l[5]=[e("svg",{class:"mx-auto h-8 w-8 animate-spin text-blue-600",fill:"none",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",fill:"currentColor"})],-1),e("p",{class:"mt-2 text-sm text-gray-500"},"Loading usage statistics...",-1)]))):(u(),n("div",ye,[e("div",pe,[e("div",fe,[e("div",be,[e("div",ke,[l[7]||(l[7]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M13 10V3L4 14h7v7l9-11h-7z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",he,[e("dl",null,[l[6]||(l[6]=e("dt",{class:"truncate text-sm font-medium text-blue-600"},"Requests",-1)),e("dd",we,d(a(((o=m.value)==null?void 0:o.totalRequests)||0)),1)])])])])]),e("div",$e,[e("div",_e,[e("div",Ce,[l[9]||(l[9]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",Me,[e("dl",null,[l[8]||(l[8]=e("dt",{class:"truncate text-sm font-medium text-green-600"},"Input Tokens",-1)),e("dd",Ae,d(a(((C=m.value)==null?void 0:C.totalInputTokens)||0)),1)])])])])]),e("div",Ue,[e("div",je,[e("div",ze,[l[11]||(l[11]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",Ve,[e("dl",null,[l[10]||(l[10]=e("dt",{class:"truncate text-sm font-medium text-purple-600"},"Output Tokens",-1)),e("dd",Be,d(a(((T=m.value)==null?void 0:T.totalOutputTokens)||0)),1)])])])])]),e("div",Le,[e("div",Se,[e("div",Ie,[l[13]||(l[13]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",Te,[e("dl",null,[l[12]||(l[12]=e("dt",{class:"truncate text-sm font-medium text-yellow-600"},"Total Cost",-1)),e("dd",Ne," $"+d((((N=m.value)==null?void 0:N.totalCost)||0).toFixed(4)),1)])])])])])]),((P=(K=r.value)==null?void 0:K.apiKeys)==null?void 0:P.length)>0?(u(),n("div",Ke,[l[15]||(l[15]=e("div",{class:"border-b border-gray-200 px-4 py-5 sm:px-6"},[e("h4",{class:"text-lg font-medium leading-6 text-gray-900"},"API Keys Usage")],-1)),e("div",Pe,[e("table",De,[l[14]||(l[14]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",scope:"col"}," API Key "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",scope:"col"}," Status "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",scope:"col"}," Requests "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",scope:"col"}," Tokens "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",scope:"col"}," Cost "),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",scope:"col"}," Last Used ")])],-1)),e("tbody",Fe,[(u(!0),n(E,null,Y(r.value.apiKeys,h=>{var D,F,s,t;return u(),n("tr",{key:h.id},[e("td",Re,[e("div",qe,d(h.name),1),e("div",He,d(h.keyPreview),1)]),e("td",Oe,[e("span",{class:V(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",h.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},d(h.isActive?"Active":"Disabled"),3)]),e("td",Qe,d(a(((D=h.usage)==null?void 0:D.requests)||0)),1),e("td",Ee,[e("div",null,"In: "+d(a(((F=h.usage)==null?void 0:F.inputTokens)||0)),1),e("div",null,"Out: "+d(a(((s=h.usage)==null?void 0:s.outputTokens)||0)),1)]),e("td",Ye," $"+d((((t=h.usage)==null?void 0:t.totalCost)||0).toFixed(4)),1),e("td",Ge,d(h.lastUsedAt?c(h.lastUsedAt):"Never"),1)])}),128))])])])])):A("",!0),e("div",Je,[l[19]||(l[19]=e("div",{class:"border-b border-gray-200 px-4 py-5 sm:px-6"},[e("h4",{class:"text-lg font-medium leading-6 text-gray-900"},"Usage Trend")],-1)),e("div",We,[e("div",Xe,[e("div",Ze,[l[16]||(l[16]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)),l[17]||(l[17]=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Usage Chart",-1)),e("p",et," Daily usage trends for "+d(y.value)+" period ",1),l[18]||(l[18]=e("p",{class:"mt-2 text-xs text-gray-400"}," (Chart integration can be added with Chart.js, D3.js, or similar library) ",-1))])])])]),m.value&&m.value.totalRequests===0?(u(),n("div",tt,l[20]||(l[20]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1),e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No usage data",-1),e("p",{class:"mt-1 text-sm text-gray-500"}," This user hasn't made any API requests in the selected period. ",-1)]))):A("",!0)])),e("div",st,[e("button",{class:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",onClick:l[2]||(l[2]=h=>b.$emit("close"))}," Close ")])])])])):A("",!0)}}},lt=J(ot,[["__scopeId","data-v-3ed8ad13"]]),rt={key:0,class:"fixed inset-0 z-50 h-full w-full overflow-y-auto bg-gray-600 bg-opacity-50"},at={class:"relative top-20 mx-auto w-96 rounded-md border bg-white p-5 shadow-lg"},dt={class:"mt-3"},it={class:"mb-4 flex items-center justify-between"},nt={key:0,class:"space-y-4"},ut={class:"rounded-md bg-gray-50 p-4"},ct={class:"flex items-center"},xt={class:"ml-4"},mt={class:"text-sm font-medium text-gray-900"},gt={class:"text-sm text-gray-500"},vt={class:"mt-1"},yt={class:"space-y-2"},pt={class:"flex items-center"},ft=["disabled"],bt={class:"flex items-center"},kt=["disabled"],ht={key:0,class:"rounded-md border border-yellow-200 bg-yellow-50 p-4"},wt={class:"flex"},$t={class:"ml-3"},_t={class:"mt-2 text-sm text-yellow-700"},Ct={key:0},Mt={key:1},At={key:1,class:"rounded-md border border-red-200 bg-red-50 p-4"},Ut={class:"flex"},jt={class:"ml-3"},zt={class:"text-sm text-red-700"},Vt={class:"flex justify-end space-x-3 pt-4"},Bt=["disabled"],Lt=["disabled"],St={key:0,class:"flex items-center"},It={key:1},Tt={__name:"ChangeRoleModal",props:{show:{type:Boolean,default:!1},user:{type:Object,default:null}},emits:["close","updated"],setup(f,{emit:_}){const g=f,$=_,i=p(!1),y=p(""),m=p(""),r=async()=>{var a,c;if(!(!g.user||m.value===g.user.role)){i.value=!0,y.value="";try{const k=await B.patch(`/users/${g.user.id}/role`,{role:m.value});k.success?(j(`用户角色已更新为${m.value==="admin"?"管理员":"普通用户"}`,"success"),$("updated")):y.value=k.message||"更新用户角色失败"}catch(k){console.error("Update user role error:",k),y.value=((c=(a=k.response)==null?void 0:a.data)==null?void 0:c.message)||k.message||"更新用户角色失败"}finally{i.value=!1}}};return Q([()=>g.show,()=>g.user],([a,c])=>{a&&c&&(m.value=c.role,y.value="",i.value=!1)}),(a,c)=>f.show?(u(),n("div",rt,[e("div",at,[e("div",dt,[e("div",it,[c[5]||(c[5]=e("h3",{class:"text-lg font-medium text-gray-900"},"修改用户角色",-1)),e("button",{class:"text-gray-400 hover:text-gray-600",onClick:c[0]||(c[0]=k=>a.$emit("close"))},c[4]||(c[4]=[e("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M6 18L18 6M6 6l12 12","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)]))]),f.user?(u(),n("div",nt,[e("div",ut,[e("div",ct,[c[6]||(c[6]=e("div",{class:"flex-shrink-0"},[e("div",{class:"flex h-10 w-10 items-center justify-center rounded-full bg-gray-300"},[e("svg",{class:"h-6 w-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])])],-1)),e("div",xt,[e("p",mt,d(f.user.displayName||f.user.username),1),e("p",gt,"@"+d(f.user.username),1),e("div",vt,[e("span",{class:V(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",f.user.role==="admin"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"])}," 当前："+d(f.user.role==="admin"?"管理员":"普通用户"),3)])])])]),e("form",{class:"space-y-4",onSubmit:te(r,["prevent"])},[e("div",null,[c[9]||(c[9]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700"},"新角色",-1)),e("div",yt,[e("label",pt,[M(e("input",{"onUpdate:modelValue":c[1]||(c[1]=k=>m.value=k),class:"h-4 w-4 border-gray-300 text-blue-600 focus:ring-blue-500",disabled:i.value,type:"radio",value:"user"},null,8,ft),[[Z,m.value]]),c[7]||(c[7]=e("div",{class:"ml-3"},[e("div",{class:"text-sm font-medium text-gray-900"},"普通用户"),e("div",{class:"text-xs text-gray-500"},"具有基本权限的普通用户")],-1))]),e("label",bt,[M(e("input",{"onUpdate:modelValue":c[2]||(c[2]=k=>m.value=k),class:"h-4 w-4 border-gray-300 text-blue-600 focus:ring-blue-500",disabled:i.value,type:"radio",value:"admin"},null,8,kt),[[Z,m.value]]),c[8]||(c[8]=e("div",{class:"ml-3"},[e("div",{class:"text-sm font-medium text-gray-900"},"管理员"),e("div",{class:"text-xs text-gray-500"},"拥有管理用户和系统的完整权限")],-1))])])]),m.value!==f.user.role?(u(),n("div",ht,[e("div",wt,[c[11]||(c[11]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"clip-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","fill-rule":"evenodd"})])],-1)),e("div",$t,[c[10]||(c[10]=e("h3",{class:"text-sm font-medium text-yellow-800"},"角色变更警告",-1)),e("div",_t,[m.value==="admin"?(u(),n("p",Ct," 授予管理员权限将使该用户拥有系统的完全访问权限，包括管理其他用户及其 API Keys 的能力。 ")):(u(),n("p",Mt," 移除管理员权限将限制该用户只能管理自己的 API Keys 和查看自己的使用统计。 "))])])])])):A("",!0),y.value?(u(),n("div",At,[e("div",Ut,[c[12]||(c[12]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"clip-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","fill-rule":"evenodd"})])],-1)),e("div",jt,[e("p",zt,d(y.value),1)])])])):A("",!0),e("div",Vt,[e("button",{class:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50",disabled:i.value,type:"button",onClick:c[3]||(c[3]=k=>a.$emit("close"))}," 取消 ",8,Bt),e("button",{class:"rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",disabled:i.value||m.value===f.user.role,type:"submit"},[i.value?(u(),n("span",St,c[13]||(c[13]=[e("svg",{class:"-ml-1 mr-2 h-4 w-4 animate-spin text-white",fill:"none",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",fill:"currentColor"})],-1),q(" 更新中... ",-1)]))):(u(),n("span",It,"更新角色"))],8,Lt)])],32)])):A("",!0)])])])):A("",!0)}},Nt=J(Tt,[["__scopeId","data-v-baae05d0"]]),Kt={key:0,class:"fixed inset-0 z-50 h-full w-full overflow-y-auto bg-gray-900/60"},Pt={class:"relative top-10 mx-auto w-full max-w-xl rounded-lg bg-white shadow dark:bg-gray-800"},Dt={class:"flex items-center justify-between border-b px-6 py-4 dark:border-gray-700"},Ft={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Rt={class:"sm:col-span-2"},qt={class:"flex items-center space-x-2"},Ht={class:"flex items-center justify-end space-x-3 pt-2"},Ot=["disabled"],Qt={key:0,class:"-ml-1 mr-2 h-4 w-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},Et={key:1},Yt={__name:"CreateUserModal",props:{show:{type:Boolean,default:!1}},emits:["close","created"],setup(f,{emit:_}){const g=_,$=p(!1),i=le({username:"",displayName:"",email:"",firstName:"",lastName:"",role:"user",isActive:!0});async function y(){var m,r;if(!i.username){j("用户名为必填项","error");return}$.value=!0;try{const a=await B.post("/users",{...i});a&&a.success?(j("用户创建成功","success"),g("created",a.user),g("close")):j((a==null?void 0:a.message)||"创建失败","error")}catch(a){j(((r=(m=a==null?void 0:a.response)==null?void 0:m.data)==null?void 0:r.message)||a.message||"创建失败","error")}finally{$.value=!1}}return(m,r)=>f.show?(u(),n("div",Kt,[e("div",Pt,[e("div",Dt,[r[10]||(r[10]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"创建用户",-1)),e("button",{class:"text-gray-400 hover:text-gray-600",onClick:r[0]||(r[0]=a=>g("close"))},r[9]||(r[9]=[e("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M6 18L18 6M6 6l12 12","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)]))]),e("form",{class:"space-y-4 px-6 py-5",onSubmit:te(y,["prevent"])},[e("div",Ft,[e("div",Rt,[r[11]||(r[11]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},"用户名",-1)),M(e("input",{"onUpdate:modelValue":r[1]||(r[1]=a=>i.username=a),class:"block w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",placeholder:"必填",required:""},null,512),[[R,i.username,void 0,{trim:!0}]])]),e("div",null,[r[12]||(r[12]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},"显示名称",-1)),M(e("input",{"onUpdate:modelValue":r[2]||(r[2]=a=>i.displayName=a),class:"block w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",placeholder:"可选"},null,512),[[R,i.displayName,void 0,{trim:!0}]])]),e("div",null,[r[13]||(r[13]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},"邮箱",-1)),M(e("input",{"onUpdate:modelValue":r[3]||(r[3]=a=>i.email=a),class:"block w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",placeholder:"可选",type:"email"},null,512),[[R,i.email,void 0,{trim:!0}]])]),e("div",null,[r[14]||(r[14]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},"名",-1)),M(e("input",{"onUpdate:modelValue":r[4]||(r[4]=a=>i.firstName=a),class:"block w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",placeholder:"可选"},null,512),[[R,i.firstName,void 0,{trim:!0}]])]),e("div",null,[r[15]||(r[15]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},"姓",-1)),M(e("input",{"onUpdate:modelValue":r[5]||(r[5]=a=>i.lastName=a),class:"block w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",placeholder:"可选"},null,512),[[R,i.lastName,void 0,{trim:!0}]])]),e("div",null,[r[17]||(r[17]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},"角色",-1)),M(e("select",{"onUpdate:modelValue":r[6]||(r[6]=a=>i.role=a),class:"block w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm"},r[16]||(r[16]=[e("option",{value:"user"},"user",-1),e("option",{value:"admin"},"admin",-1)]),512),[[O,i.role]])]),e("div",qt,[M(e("input",{id:"active","onUpdate:modelValue":r[7]||(r[7]=a=>i.isActive=a),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500",type:"checkbox"},null,512),[[re,i.isActive]]),r[18]||(r[18]=e("label",{class:"text-sm text-gray-700 dark:text-gray-300",for:"active"},"启用",-1))])]),e("div",Ht,[e("button",{class:"rounded-md border px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-gray-700",type:"button",onClick:r[8]||(r[8]=a=>g("close"))}," 取消 "),e("button",{class:"inline-flex items-center rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow hover:bg-blue-700 disabled:opacity-50",disabled:$.value,type:"submit"},[$.value?(u(),n("svg",Qt,r[19]||(r[19]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",fill:"currentColor"},null,-1)]))):A("",!0),r[20]||(r[20]=q(" 创建 ",-1))],8,Ot)])],32)])])):(u(),n("div",Et))}},Gt={key:0,class:"fixed inset-0 z-50 h-full w-full overflow-y-auto bg-gray-900/60"},Jt={class:"relative top-8 mx-auto w-11/12 max-w-5xl rounded-lg bg-white shadow dark:bg-gray-800"},Wt={class:"flex items-center justify-between border-b px-6 py-4 dark:border-gray-700"},Xt={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},Zt={class:"px-6 py-5"},es={class:"mb-4 flex flex-wrap items-center justify-between gap-3"},ts={class:"space-y-1"},ss={class:"text-sm text-gray-700 dark:text-gray-300"},os={class:"text-sm text-gray-700 dark:text-gray-300"},ls={class:"text-sm text-gray-700 dark:text-gray-300"},rs={class:"border-b dark:border-gray-700"},as={"aria-label":"Tabs",class:"-mb-px flex space-x-6"},ds={class:"pt-4"},is={key:0},ns={class:"overflow-x-auto"},us={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},cs={class:"divide-y divide-gray-100 dark:divide-gray-700"},xs={class:"px-4 py-2 text-sm text-gray-800 dark:text-gray-200"},ms={class:"px-4 py-2 text-sm text-gray-600 dark:text-gray-300"},gs={class:"px-4 py-2 text-sm text-gray-600 dark:text-gray-300"},vs={class:"px-4 py-2 text-sm text-gray-600 dark:text-gray-300"},ys={class:"px-4 py-2 text-sm"},ps={class:"px-4 py-2 text-sm text-gray-600 dark:text-gray-300"},fs={key:0},bs={key:1},ks={class:"overflow-x-auto"},hs={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},ws={class:"divide-y divide-gray-100 dark:divide-gray-700"},$s={class:"px-4 py-2 font-mono text-sm text-gray-800 dark:text-gray-200"},_s={class:"px-4 py-2 text-sm"},Cs={class:"px-4 py-2 text-sm text-gray-600 dark:text-gray-300"},Ms={class:"px-4 py-2 text-sm text-gray-600 dark:text-gray-300"},As={key:0},Us={key:2},js={class:"space-y-6"},zs={class:"flex items-center justify-between"},Vs={key:0,class:"py-8 text-center"},Bs={key:1,class:"grid grid-cols-1 gap-4 md:grid-cols-4"},Ls={class:"rounded-lg bg-gray-50 p-4 dark:bg-gray-700"},Ss={class:"mt-1 text-2xl font-semibold text-gray-900 dark:text-white"},Is={class:"rounded-lg bg-gray-50 p-4 dark:bg-gray-700"},Ts={class:"mt-1 text-2xl font-semibold text-gray-900 dark:text-white"},Ns={class:"rounded-lg bg-gray-50 p-4 dark:bg-gray-700"},Ks={class:"mt-1 text-2xl font-semibold text-gray-900 dark:text-white"},Ps={class:"rounded-lg bg-gray-50 p-4 dark:bg-gray-700"},Ds={class:"mt-1 text-2xl font-semibold text-gray-900 dark:text-white"},Fs={key:2,class:"py-8 text-center"},Rs={key:1},qs={__name:"UserDetailModal",props:{show:{type:Boolean,default:!1},user:{type:Object,default:null}},emits:["close"],setup(f,{emit:_}){const g=f,$=_,i=p("keys"),y=p(null),m=p([]),r=p(!1),a=p(null),c=p("week"),k=se(()=>{var v,o;return((o=(v=y.value)==null?void 0:v.user)==null?void 0:o.apiKeys)||[]});function b(v){return["border-b-2 px-3 py-2 text-sm font-medium",i.value===v?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"]}function l(v){return v>=1e6?(v/1e6).toFixed(1)+"M":v>=1e3?(v/1e3).toFixed(1)+"K":String(v||0)}function U(v){if(!v)return"-";try{return new Date(v).toLocaleString()}catch{return"-"}}async function S(){var v;if((v=g.user)!=null&&v.id)try{const[o,C]=await Promise.all([B.get(`/users/${g.user.id}`),B.get(`/users/${g.user.id}/redeems`)]);o!=null&&o.success&&(y.value=o),C!=null&&C.success&&(m.value=C.redeems||C.data||[])}catch{j("加载用户详情失败","error")}}async function I(){var v;if((v=g.user)!=null&&v.id){r.value=!0;try{const o=await B.get(`/users/${g.user.id}/usage-stats`,{params:{period:c.value}});o!=null&&o.success&&(a.value=o.stats)}catch(o){console.error("Failed to load usage stats:",o),j("加载使用统计失败","error")}finally{r.value=!1}}}return Q(()=>g.show,v=>{v&&(i.value="keys",S(),i.value==="usage"&&I())}),Q(()=>i.value,v=>{v==="usage"&&g.show&&I()}),oe(()=>{g.show&&(S(),i.value==="usage"&&I())}),(v,o)=>{var C,T,N,K,P,h,D,F;return f.show?(u(),n("div",Gt,[e("div",Jt,[e("div",Wt,[e("div",null,[o[5]||(o[5]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"用户详情",-1)),f.user?(u(),n("p",Xt," @"+d(f.user.username)+" · "+d(f.user.role),1)):A("",!0)]),e("button",{class:"text-gray-400 hover:text-gray-600",onClick:o[0]||(o[0]=s=>$("close"))},o[6]||(o[6]=[e("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M6 18L18 6M6 6l12 12","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)]))]),e("div",Zt,[e("div",es,[e("div",ts,[e("div",ss," 昵称："+d(((T=(C=y.value)==null?void 0:C.user)==null?void 0:T.displayName)||"-"),1),e("div",os," 邮箱："+d(((K=(N=y.value)==null?void 0:N.user)==null?void 0:K.email)||"-"),1),e("div",ls,[o[7]||(o[7]=q(" 状态： ",-1)),e("span",{class:V((h=(P=y.value)==null?void 0:P.user)!=null&&h.isActive?"text-green-600":"text-red-500")},d((F=(D=y.value)==null?void 0:D.user)!=null&&F.isActive?"启用":"禁用"),3)])])]),e("div",rs,[e("nav",as,[e("button",{class:V(b("keys")),onClick:o[1]||(o[1]=s=>i.value="keys")},"API Keys",2),e("button",{class:V(b("redeems")),onClick:o[2]||(o[2]=s=>i.value="redeems")},"兑换码",2),e("button",{class:V(b("usage")),onClick:o[3]||(o[3]=s=>i.value="usage")},"使用统计",2)])]),e("div",ds,[i.value==="keys"?(u(),n("div",is,[e("div",ns,[e("table",us,[o[9]||(o[9]=e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," 名称 "),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," 请求数 "),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," Tokens (令牌数) "),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," 总消费 "),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," 状态 "),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," 创建时间 ")])],-1)),e("tbody",cs,[(u(!0),n(E,null,Y(k.value,s=>{var t,w,z,L;return u(),n("tr",{key:s.id},[e("td",xs,d(s.name),1),e("td",ms,d(l(((t=s.usage)==null?void 0:t.requests)||0)),1),e("td",gs,d(l((((w=s.usage)==null?void 0:w.inputTokens)||0)+(((z=s.usage)==null?void 0:z.outputTokens)||0))),1),e("td",vs," $"+d((((L=s.usage)==null?void 0:L.totalCost)||0).toFixed(4)),1),e("td",ys,[e("span",{class:V(s.isActive?"text-green-500":"text-red-500")},d(s.isActive?"活跃":"禁用"),3)]),e("td",ps,d(U(s.createdAt)),1)])}),128)),k.value.length===0?(u(),n("tr",fs,o[8]||(o[8]=[e("td",{class:"px-4 py-6 text-center text-sm text-gray-500",colspan:"6"}," 暂无 API Keys ",-1)]))):A("",!0)])])])])):i.value==="redeems"?(u(),n("div",bs,[e("div",ks,[e("table",hs,[o[11]||(o[11]=e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," 兑换码 "),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," 状态 "),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," 关联 Key "),e("th",{class:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," 创建/激活时间 ")])],-1)),e("tbody",ws,[(u(!0),n(E,null,Y(m.value,s=>(u(),n("tr",{key:s.code},[e("td",$s,d(s.code),1),e("td",_s,[e("span",{class:V(s.status==="used"?"text-green-600":s.status==="unused"?"text-gray-500":"text-yellow-600")},d(s.status==="used"?"已使用":s.status==="unused"?"未使用":s.status==="expired"?"已过期":s.status),3)]),e("td",Cs,d(s.apiKeyName||s.apiKeyId||"-"),1),e("td",Ms,d(U(s.activatedAt||s.createdAt)),1)]))),128)),m.value.length===0?(u(),n("tr",As,o[10]||(o[10]=[e("td",{class:"px-4 py-6 text-center text-sm text-gray-500",colspan:"4"}," 暂无兑换码 ",-1)]))):A("",!0)])])])])):(u(),n("div",Us,[e("div",js,[e("div",zs,[o[13]||(o[13]=e("h4",{class:"text-sm font-medium text-gray-900 dark:text-white"},"使用统计",-1)),M(e("select",{"onUpdate:modelValue":o[4]||(o[4]=s=>c.value=s),class:"block w-40 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",onChange:I},o[12]||(o[12]=[e("option",{value:"day"},"最近 24 小时",-1),e("option",{value:"week"},"最近 7 天",-1),e("option",{value:"month"},"最近 30 天",-1),e("option",{value:"quarter"},"最近 90 天",-1)]),544),[[O,c.value]])]),r.value?(u(),n("div",Vs,o[14]||(o[14]=[e("svg",{class:"mx-auto h-8 w-8 animate-spin text-blue-600",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",fill:"currentColor"})],-1),e("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"},"加载中...",-1)]))):a.value?(u(),n("div",Bs,[e("div",Ls,[o[15]||(o[15]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"总请求数",-1)),e("div",Ss,d(l(a.value.totalRequests||0)),1)]),e("div",Is,[o[16]||(o[16]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"输入 Tokens",-1)),e("div",Ts,d(l(a.value.totalInputTokens||0)),1)]),e("div",Ns,[o[17]||(o[17]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"输出 Tokens",-1)),e("div",Ks,d(l(a.value.totalOutputTokens||0)),1)]),e("div",Ps,[o[18]||(o[18]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"总消费",-1)),e("div",Ds," $"+d((a.value.totalCost||0).toFixed(4)),1)])])):(u(),n("div",Fs,o[19]||(o[19]=[e("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"暂无使用数据",-1)])))])]))])])])])):(u(),n("div",Rs))}}},Hs={class:"space-y-6"},Os={class:"sm:flex sm:items-center"},Qs={class:"mt-4 space-x-3 sm:ml-16 sm:mt-0 sm:flex-none"},Es=["disabled"],Ys=["disabled"],Gs={class:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-4"},Js={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},Ws={class:"p-5"},Xs={class:"flex items-center"},Zs={class:"ml-5 w-0 flex-1"},eo={class:"text-lg font-medium text-gray-900 dark:text-white"},to={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},so={class:"p-5"},oo={class:"flex items-center"},lo={class:"ml-5 w-0 flex-1"},ro={class:"text-lg font-medium text-gray-900 dark:text-white"},ao={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},io={class:"p-5"},no={class:"flex items-center"},uo={class:"ml-5 w-0 flex-1"},co={class:"text-lg font-medium text-gray-900 dark:text-white"},xo={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},mo={class:"p-5"},go={class:"flex items-center"},vo={class:"ml-5 w-0 flex-1"},yo={class:"text-lg font-medium text-gray-900 dark:text-white"},po={class:"rounded-lg bg-white shadow dark:bg-gray-800"},fo={class:"px-4 py-5 sm:p-6"},bo={class:"sm:flex sm:items-center sm:justify-between"},ko={class:"space-y-4 sm:flex sm:items-center sm:space-x-4 sm:space-y-0"},ho={class:"min-w-0 flex-1"},wo={class:"relative rounded-md shadow-sm"},$o={class:"overflow-hidden bg-white shadow dark:bg-gray-800 sm:rounded-md"},_o={class:"border-b border-gray-200 px-4 py-5 dark:border-gray-700 sm:px-6"},Co={class:"text-lg font-medium leading-6 text-gray-900 dark:text-white"},Mo={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Ao={key:0,class:"py-12 text-center"},Uo={key:1,class:"divide-y divide-gray-200 dark:divide-gray-700",role:"list"},jo={class:"flex items-center justify-between"},zo={class:"flex min-w-0 flex-1 items-center"},Vo={class:"ml-4 min-w-0 flex-1"},Bo={class:"flex items-center"},Lo={class:"truncate text-sm font-medium text-gray-900 dark:text-white"},So={class:"ml-2 flex items-center space-x-2"},Io={class:"mt-1 flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400"},To={key:0},No={key:1},Ko={key:2},Po={key:0,class:"mt-1 flex items-center space-x-4 text-xs text-gray-400 dark:text-gray-500"},Do={class:"flex items-center space-x-2"},Fo=["onClick"],Ro=["disabled","onClick"],qo=["title","onClick"],Ho={key:0,class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Oo={key:1,class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Qo=["onClick"],Eo={key:2,class:"py-12 text-center"},Yo={class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},Go={__name:"UserManagementView",setup(f){const _=p(!0),g=p([]),$=p(null),i=p(""),y=p(""),m=p(""),r=p(!1),a=p(!1),c=p(!1),k=p(!1),b=p(!1),l=p(null),U=p({title:"",message:"",confirmText:"",confirmClass:"",action:null}),S=se(()=>{let s=g.value;if(i.value){const t=i.value.toLowerCase();s=s.filter(w=>{var z,L;return w.username.toLowerCase().includes(t)||((z=w.displayName)==null?void 0:z.toLowerCase().includes(t))||((L=w.email)==null?void 0:L.toLowerCase().includes(t))})}if(y.value&&(s=s.filter(t=>t.role===y.value)),m.value!==""){const t=m.value==="true";s=s.filter(w=>w.isActive===t)}return s}),I=s=>s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(1)+"K":s.toString(),v=s=>s?new Date(s).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):null,o=async()=>{_.value=!0;try{const s={};y.value&&y.value.trim()!==""&&(s.role=y.value),m.value!==""&&(s.isActive=m.value);const[t,w]=await Promise.all([B.get("/users",{params:s}),B.get("/users/stats/overview")]);t.success&&(g.value=t.users),w.success&&($.value=w.stats)}catch(s){console.error("Failed to load users:",s),j("加载用户失败","error")}finally{_.value=!1}},C=de(()=>{},300),T=s=>{l.value=s,b.value=!0},N=s=>{l.value=s,U.value={title:s.isActive?"禁用用户":"启用用户",message:s.isActive?`确定要禁用用户 "${s.username}" 吗？这将阻止他们登录。`:`确定要启用用户 "${s.username}" 吗？`,confirmText:s.isActive?"禁用":"启用",confirmClass:s.isActive?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700",action:"toggleStatus"},a.value=!0},K=s=>{s.apiKeyCount!==0&&(l.value=s,U.value={title:"禁用所有 API Keys",message:`确定要禁用用户 "${s.username}" 的所有 ${s.apiKeyCount} 个 API Keys 吗？这将阻止他们使用服务。`,confirmText:"禁用",confirmClass:"bg-red-600 hover:bg-red-700",action:"disableKeys"},a.value=!0)},P=s=>{l.value=s,c.value=!0},h=async()=>{const s=l.value,t=U.value.action;try{if(t==="toggleStatus"){if((await B.patch(`/users/${s.id}/status`,{isActive:!s.isActive})).success){const z=g.value.findIndex(L=>L.id===s.id);z!==-1&&(g.value[z].isActive=!s.isActive),j(`用户已${s.isActive?"禁用":"启用"}`,"success")}}else if(t==="disableKeys"){const w=await B.post(`/users/${s.id}/disable-keys`);w.success&&(j(`已禁用 ${w.disabledCount} 个 API Keys`,"success"),await o())}}catch(w){console.error(`Failed to ${t}:`,w),j(`操作失败：${t==="toggleStatus"?"更新用户状态":"禁用 API Keys"}`,"error")}finally{a.value=!1,l.value=null}},D=()=>{c.value=!1,l.value=null,o()},F=()=>{k.value=!1,o()};return oe(()=>{o()}),(s,t)=>{var w,z,L,W,X;return u(),n("div",Hs,[e("div",Os,[t[12]||(t[12]=e("div",{class:"sm:flex-auto"},[e("h1",{class:"text-2xl font-semibold text-gray-900 dark:text-white"},"用户管理"),e("p",{class:"mt-2 text-sm text-gray-700 dark:text-gray-300"},"管理用户、API Keys 和使用统计")],-1)),e("div",Qs,[e("button",{class:"inline-flex items-center justify-center rounded-md border border-transparent bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600",disabled:_.value,onClick:t[0]||(t[0]=x=>k.value=!0)},t[10]||(t[10]=[e("svg",{class:"-ml-1 mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 4v16m8-8H4","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1),q(" 创建用户 ",-1)]),8,Es),e("button",{class:"inline-flex items-center justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 sm:w-auto",disabled:_.value,onClick:o},t[11]||(t[11]=[e("svg",{class:"-ml-1 mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1),q(" 刷新 ",-1)]),8,Ys)])]),e("div",Gs,[e("div",Js,[e("div",Ws,[e("div",Xs,[t[14]||(t[14]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",Zs,[e("dl",null,[t[13]||(t[13]=e("dt",{class:"truncate text-sm font-medium text-gray-500 dark:text-gray-400"}," 总用户数 ",-1)),e("dd",eo,d(((w=$.value)==null?void 0:w.totalUsers)||0),1)])])])])]),e("div",to,[e("div",so,[e("div",oo,[t[16]||(t[16]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",lo,[e("dl",null,[t[15]||(t[15]=e("dt",{class:"truncate text-sm font-medium text-gray-500 dark:text-gray-400"}," 活跃用户 ",-1)),e("dd",ro,d(((z=$.value)==null?void 0:z.activeUsers)||0),1)])])])])]),e("div",ao,[e("div",io,[e("div",no,[t[18]||(t[18]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M15 7a2 2 0 012 2m0 0a2 2 0 012 2m-2-2h-6m6 0v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9a2 2 0 012-2h6z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",uo,[e("dl",null,[t[17]||(t[17]=e("dt",{class:"truncate text-sm font-medium text-gray-500 dark:text-gray-400"}," 总 API Keys ",-1)),e("dd",co,d(((L=$.value)==null?void 0:L.totalApiKeys)||0),1)])])])])]),e("div",xo,[e("div",mo,[e("div",go,[t[20]||(t[20]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-yellow-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),e("div",vo,[e("dl",null,[t[19]||(t[19]=e("dt",{class:"truncate text-sm font-medium text-gray-500 dark:text-gray-400"}," 总消费 ",-1)),e("dd",yo," $"+d((((X=(W=$.value)==null?void 0:W.totalUsage)==null?void 0:X.totalCost)||0).toFixed(4)),1)])])])])])]),e("div",po,[e("div",fo,[e("div",bo,[e("div",ko,[e("div",ho,[e("div",wo,[t[21]||(t[21]=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])],-1)),M(e("input",{"onUpdate:modelValue":t[1]||(t[1]=x=>i.value=x),class:"block w-full rounded-md border-gray-300 pl-10 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",placeholder:"搜索用户...",type:"search",onInput:t[2]||(t[2]=(...x)=>ee(C)&&ee(C)(...x))},null,544),[[R,i.value]])])]),e("div",null,[M(e("select",{"onUpdate:modelValue":t[3]||(t[3]=x=>y.value=x),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",onChange:o},t[22]||(t[22]=[e("option",{value:""},"所有角色",-1),e("option",{value:"user"},"普通用户",-1),e("option",{value:"admin"},"管理员",-1)]),544),[[O,y.value]])]),e("div",null,[M(e("select",{"onUpdate:modelValue":t[4]||(t[4]=x=>m.value=x),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm",onChange:o},t[23]||(t[23]=[e("option",{value:""},"所有状态",-1),e("option",{value:"true"},"启用",-1),e("option",{value:"false"},"禁用",-1)]),544),[[O,m.value]])])])])])]),e("div",$o,[e("div",_o,[e("h3",Co,[t[24]||(t[24]=q(" 用户列表 ",-1)),_.value?A("",!0):(u(),n("span",Mo,"("+d(S.value.length)+" / "+d(g.value.length)+")",1))])]),_.value?(u(),n("div",Ao,t[25]||(t[25]=[e("svg",{class:"mx-auto h-8 w-8 animate-spin text-blue-600",fill:"none",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",fill:"currentColor"})],-1),e("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"},"加载中...",-1)]))):S.value.length>0?(u(),n("ul",Uo,[(u(!0),n(E,null,Y(S.value,x=>(u(),n("li",{key:x.id,class:"px-6 py-4"},[e("div",jo,[e("div",zo,[t[26]||(t[26]=e("div",{class:"flex-shrink-0"},[e("div",{class:"flex h-10 w-10 items-center justify-center rounded-full bg-gray-300 dark:bg-gray-600"},[e("svg",{class:"h-6 w-6 text-gray-600 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})])])],-1)),e("div",Vo,[e("div",Bo,[e("p",Lo,d(x.displayName||x.username),1),e("div",So,[e("span",{class:V(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",x.isActive?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"])},d(x.isActive?"启用":"禁用"),3),e("span",{class:V(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",x.role==="admin"?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"])},d(x.role==="admin"?"管理员":"普通用户"),3)])]),e("div",Io,[e("span",null,"@"+d(x.username),1),x.email?(u(),n("span",To,d(x.email),1)):A("",!0),e("span",null,d(x.apiKeyCount||0)+" 个 API Keys",1),x.lastLoginAt?(u(),n("span",No,"最后登录："+d(v(x.lastLoginAt)),1)):(u(),n("span",Ko,"从未登录"))]),x.totalUsage?(u(),n("div",Po,[e("span",null,d(I(x.totalUsage.requests||0))+" 次请求",1),e("span",null,"总消费 $"+d((x.totalUsage.totalCost||0).toFixed(4)),1)])):A("",!0)])]),e("div",Do,[e("button",{class:"inline-flex items-center rounded border border-transparent p-1 text-gray-400 hover:text-blue-600",title:"查看详情",onClick:G=>T(x)},t[27]||(t[27]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)]),8,Fo),e("button",{class:"inline-flex items-center rounded border border-transparent p-1 text-gray-400 hover:text-red-600 disabled:cursor-not-allowed disabled:opacity-50",disabled:x.apiKeyCount===0,title:"禁用所有 API Keys",onClick:G=>K(x)},t[28]||(t[28]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18 12M6 6l12 12","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)]),8,Ro),e("button",{class:V(["inline-flex items-center rounded border border-transparent p-1",x.isActive?"text-gray-400 hover:text-red-600":"text-gray-400 hover:text-green-600"]),title:x.isActive?"禁用用户":"启用用户",onClick:G=>N(x)},[x.isActive?(u(),n("svg",Ho,t[29]||(t[29]=[e("path",{d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18 12M6 6l12 12","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},null,-1)]))):(u(),n("svg",Oo,t[30]||(t[30]=[e("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},null,-1)])))],10,qo),e("button",{class:"inline-flex items-center rounded border border-transparent p-1 text-gray-400 hover:text-purple-600",title:"修改角色",onClick:G=>P(x)},t[31]||(t[31]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)]),8,Qo)])])]))),128))])):(u(),n("div",Eo,[t[32]||(t[32]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"})],-1)),t[33]||(t[33]=e("h3",{class:"mt-2 text-sm font-medium text-gray-900 dark:text-white"},"未找到用户",-1)),e("p",Yo,d(i.value?"没有匹配搜索条件的用户。":"还没有创建任何用户。"),1)]))]),H(lt,{show:r.value,user:l.value,onClose:t[5]||(t[5]=x=>r.value=!1)},null,8,["show","user"]),H(Yt,{show:k.value,onClose:t[6]||(t[6]=x=>k.value=!1),onCreated:F},null,8,["show"]),H(qs,{show:b.value,user:l.value,onClose:t[7]||(t[7]=x=>b.value=!1)},null,8,["show","user"]),H(ae,{"confirm-class":U.value.confirmClass,"confirm-text":U.value.confirmText,message:U.value.message,show:a.value,title:U.value.title,onCancel:t[8]||(t[8]=x=>a.value=!1),onConfirm:h},null,8,["confirm-class","confirm-text","message","show","title"]),H(Nt,{show:c.value,user:l.value,onClose:t[9]||(t[9]=x=>c.value=!1),onUpdated:D},null,8,["show","user"])])}}},tl=J(Go,[["__scopeId","data-v-91c406a6"]]);export{tl as default};
