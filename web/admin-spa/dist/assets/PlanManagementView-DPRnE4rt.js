import{c as v,s as A}from"./index-DZAJWWtr.js";import{r as f,c as U,o as j,I as P,y as i,z as t,P as m,C as I,Y as T,x as d,L as g,K as o,O as x,aq as n,an as O,Q as R,aV as K,a5 as S,q as W,R as z,ac as B,u as w}from"./vue-vendor-Bsazo-x0.js";import{C as E}from"./ConfirmModal-DFtiZLRc.js";import{u as N}from"./useConfirm-CxD_hh6j.js";import"./element-plus-CqiD73Lu.js";import"./vendor-Dr8jvgFu.js";const G={class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4"},Q={class:"max-h-[90vh] w-full max-w-4xl overflow-y-auto rounded-lg bg-white shadow-xl dark:bg-gray-800"},Y={class:"sticky top-0 z-10 flex items-center justify-between border-b border-gray-200 bg-white p-4 dark:border-gray-700 dark:bg-gray-800"},H={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},J={class:"border-b border-gray-200 bg-gray-50 px-4 py-3 dark:border-gray-700 dark:bg-gray-900"},X={class:"flex items-center justify-center space-x-4"},Z={class:"flex items-center"},_={class:"flex items-center"},ee={class:"flex items-center"},te={key:0,class:"space-y-4"},le={class:"flex gap-4"},ae={class:"flex cursor-pointer items-center"},se={class:"flex cursor-pointer items-center"},re={class:"mt-1 text-xs text-gray-500"},oe=["placeholder"],ie={class:"mt-1 text-xs text-gray-500"},de={class:"mt-1 text-xs text-gray-500"},ne=["placeholder"],ue={class:"mt-1 text-xs text-gray-500"},me={key:1,class:"space-y-4"},pe={class:"rounded-lg border border-blue-200 bg-blue-50 p-3 dark:border-blue-700 dark:bg-blue-900/20"},ye={class:"grid grid-cols-1 gap-2 lg:grid-cols-3"},be={key:2,class:"space-y-4"},ge={class:"mt-6 flex justify-between"},ce={key:1},xe={class:"flex gap-3"},ve=["disabled"],fe=["disabled"],ke={__name:"CreatePlanModal",props:{plan:{type:Object,default:null}},emits:["close","success"],setup(q,{emit:h}){const b=q,D=h,k=f(!1),u=f(1),c=U(()=>!!b.plan),a=f({name:"",type:"monthly",price:0,duration:30,dailyLimitActual:0,dailyLimitDisplay:0,totalLimitActual:0,totalLimitDisplay:0,description:"",xianyuLink:""}),s=f({name:"",dailyCostLimit:0,totalCostLimit:0,weeklyOpusCostLimit:0,concurrencyLimit:0,rateLimitWindow:null,rateLimitRequests:null,rateLimitCost:null,permissions:"all",claudeAccountId:"",geminiAccountId:"",openaiAccountId:"",bedrockAccountId:"",droidAccountId:"",enableModelRestriction:!1,restrictedModels:[],enableClientRestriction:!1,allowedClients:[],tags:[],description:""}),y=U(()=>{if(a.value.type==="monthly"){const r=parseFloat(a.value.dailyLimitActual)||0,e=parseFloat(a.value.dailyLimitDisplay)||0;return!r||r===0?1:e/r}else{const r=parseFloat(a.value.totalLimitActual)||0,e=parseFloat(a.value.totalLimitDisplay)||0;return!r||r===0?1:e/r}});U(()=>a.value.speedMultiplier!==null&&a.value.speedMultiplier!==void 0&&a.value.speedMultiplier>0?parseFloat(a.value.speedMultiplier):y.value);const L=()=>{a.value.type==="monthly"?(a.value.totalLimitActual=0,a.value.totalLimitDisplay=0):(a.value.duration=30,a.value.dailyLimitActual=0,a.value.dailyLimitDisplay=0)},F=()=>{u.value<3&&(u.value===1&&$(),u.value++)},$=()=>{const r=a.value.speedMultiplier!==null&&a.value.speedMultiplier!==void 0&&a.value.speedMultiplier>0,e=r?parseFloat(a.value.speedMultiplier):y.value;if(a.value.type==="monthly"){const l=parseFloat(a.value.dailyLimitActual)||0,p=parseFloat(a.value.dailyLimitDisplay)||0;r?(s.value.dailyCostLimit=l*e,s.value.totalCostLimit=l*e*30):(s.value.dailyCostLimit=p,s.value.totalCostLimit=p*30)}else if(a.value.type==="usage"){const l=parseFloat(a.value.totalLimitActual)||0,p=parseFloat(a.value.totalLimitDisplay)||0;r?s.value.totalCostLimit=l*e:s.value.totalCostLimit=p}},M=async()=>{k.value=!0;try{const r={name:s.value.name,planId:c.value?b.plan.id:"",dailyCostLimit:s.value.dailyCostLimit||0,totalCostLimit:s.value.totalCostLimit||0,weeklyOpusCostLimit:s.value.weeklyOpusCostLimit||0,concurrencyLimit:s.value.concurrencyLimit||0,rateLimitWindow:s.value.rateLimitWindow||null,rateLimitRequests:s.value.rateLimitRequests||null,rateLimitCost:s.value.rateLimitCost||null,permissions:s.value.permissions||"all",claudeAccountId:s.value.claudeAccountId||"",geminiAccountId:s.value.geminiAccountId||"",openaiAccountId:s.value.openaiAccountId||"",bedrockAccountId:s.value.bedrockAccountId||"",droidAccountId:s.value.droidAccountId||"",enableModelRestriction:s.value.enableModelRestriction||!1,restrictedModels:s.value.restrictedModels||[],enableClientRestriction:s.value.enableClientRestriction||!1,allowedClients:s.value.allowedClients||[],tags:s.value.tags||[],description:s.value.description||""};let e;if(c.value&&b.plan.apiKeyTemplateId){const C=await v.put(`/admin/api-key-templates/${b.plan.apiKeyTemplateId}`,r);if(!C||!C.success)throw new Error("更新 API Key 模板失败");e=b.plan.apiKeyTemplateId}else{const C=await v.post("/admin/api-key-templates",r);if(!C||!C.success)throw new Error("创建 API Key 模板失败");e=C.data.id}const l={...a.value,apiKeyTemplateId:e};let p;if(c.value?p=await v.put(`/admin/plans/${b.plan.id}`,l):p=await v.post("/admin/plans",l),p&&p.success)c.value||await v.put(`/admin/api-key-templates/${e}`,{planId:p.data.id}),A(c.value?"套餐更新成功":"套餐创建成功","success"),D("success");else throw new Error((p==null?void 0:p.error)||"操作失败")}catch(r){A(r.message||"操作失败","error"),console.error("Failed to create/update plan:",r)}finally{k.value=!1}},V=async r=>{try{const e=await v.get(`/admin/api-key-templates/${r}`);if(e&&e.success&&e.data){const l=e.data;s.value={name:l.name||"",dailyCostLimit:l.dailyCostLimit||0,totalCostLimit:l.totalCostLimit||0,weeklyOpusCostLimit:l.weeklyOpusCostLimit||0,concurrencyLimit:l.concurrencyLimit||0,rateLimitWindow:l.rateLimitWindow||null,rateLimitRequests:l.rateLimitRequests||null,rateLimitCost:l.rateLimitCost||null,permissions:l.permissions||"all",claudeAccountId:l.claudeAccountId||"",geminiAccountId:l.geminiAccountId||"",openaiAccountId:l.openaiAccountId||"",bedrockAccountId:l.bedrockAccountId||"",droidAccountId:l.droidAccountId||"",enableModelRestriction:l.enableModelRestriction||!1,restrictedModels:l.restrictedModels||[],enableClientRestriction:l.enableClientRestriction||!1,allowedClients:l.allowedClients||[],tags:l.tags||[],description:l.description||""}}}catch(e){console.error("Failed to load template data:",e)}};return j([()=>a.value.type,()=>a.value.dailyLimitDisplay,()=>a.value.dailyLimitActual,()=>a.value.totalLimitDisplay,()=>a.value.totalLimitActual,()=>a.value.speedMultiplier,()=>u.value],()=>{u.value===2&&$()},{deep:!0}),j(()=>b.plan,async r=>{r?(a.value={name:r.name||"",type:r.type||"monthly",price:parseFloat(r.price)||0,duration:parseInt(r.duration)||30,dailyLimitActual:parseFloat(r.dailyLimitActual)||0,dailyLimitDisplay:parseFloat(r.dailyLimitDisplay)||0,totalLimitActual:parseFloat(r.totalLimitActual)||0,totalLimitDisplay:parseFloat(r.totalLimitDisplay)||0,speedMultiplier:r.speedMultiplier?parseFloat(r.speedMultiplier):null,description:r.description||"",xianyuLink:r.xianyuLink||""},r.apiKeyTemplateId&&await V(r.apiKeyTemplateId)):s.value={name:"",dailyCostLimit:0,totalCostLimit:0,weeklyOpusCostLimit:0,concurrencyLimit:0,rateLimitWindow:null,rateLimitRequests:null,rateLimitCost:null,permissions:"all",claudeAccountId:"",geminiAccountId:"",openaiAccountId:"",bedrockAccountId:"",droidAccountId:"",enableModelRestriction:!1,restrictedModels:[],enableClientRestriction:!1,allowedClients:[],tags:[],description:""}},{immediate:!0}),(r,e)=>(i(),P(S,{to:"body"},[t("div",G,[t("div",Q,[t("div",Y,[t("h3",H,m(c.value?"编辑套餐":"创建套餐"),1),t("button",{class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",onClick:e[0]||(e[0]=l=>r.$emit("close"))},e[26]||(e[26]=[t("i",{class:"fas fa-times"},null,-1)]))]),t("div",J,[t("div",X,[t("div",Z,[t("div",{class:I(["flex h-8 w-8 items-center justify-center rounded-full text-sm font-semibold",u.value>=1?"bg-blue-500 text-white":"bg-gray-200 text-gray-500 dark:bg-gray-700 dark:text-gray-400"])}," 1 ",2),e[27]||(e[27]=t("span",{class:"ml-2 text-sm font-medium text-gray-700 dark:text-gray-300"},"套餐信息",-1))]),e[30]||(e[30]=t("div",{class:"h-0.5 w-8 bg-gray-300 dark:bg-gray-600"},null,-1)),t("div",_,[t("div",{class:I(["flex h-8 w-8 items-center justify-center rounded-full text-sm font-semibold",u.value>=2?"bg-blue-500 text-white":"bg-gray-200 text-gray-500 dark:bg-gray-700 dark:text-gray-400"])}," 2 ",2),e[28]||(e[28]=t("span",{class:"ml-2 text-sm font-medium text-gray-700 dark:text-gray-300"},"API Key 模板",-1))]),e[31]||(e[31]=t("div",{class:"h-0.5 w-8 bg-gray-300 dark:bg-gray-600"},null,-1)),t("div",ee,[t("div",{class:I(["flex h-8 w-8 items-center justify-center rounded-full text-sm font-semibold",u.value>=3?"bg-blue-500 text-white":"bg-gray-200 text-gray-500 dark:bg-gray-700 dark:text-gray-400"])}," 3 ",2),e[29]||(e[29]=t("span",{class:"ml-2 text-sm font-medium text-gray-700 dark:text-gray-300"},"闲鱼链接",-1))])])]),t("form",{class:"p-6",onSubmit:T(M,["prevent"])},[u.value===1?(i(),d("div",te,[t("div",null,[e[32]||(e[32]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},[x(" 套餐名称 "),t("span",{class:"text-red-500"},"*")],-1)),o(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.name=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"输入套餐名称",required:""},null,512),[[n,a.value.name]])]),t("div",null,[e[35]||(e[35]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},[x(" 套餐类型 "),t("span",{class:"text-red-500"},"*")],-1)),t("div",le,[t("label",ae,[o(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.type=l),class:"mr-2 text-blue-600",type:"radio",value:"monthly",onChange:L},null,544),[[O,a.value.type]]),e[33]||(e[33]=t("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"月卡",-1))]),t("label",se,[o(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.type=l),class:"mr-2 text-blue-600",type:"radio",value:"usage",onChange:L},null,544),[[O,a.value.type]]),e[34]||(e[34]=t("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"计量",-1))])])]),t("div",null,[e[36]||(e[36]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},[x(" 价格（人民币） "),t("span",{class:"text-red-500"},"*")],-1)),o(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.price=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"0",placeholder:"输入价格",required:"",step:"0.01",type:"number"},null,512),[[n,a.value.price,void 0,{number:!0}]])]),a.value.type==="monthly"?(i(),d(R,{key:0},[t("div",null,[e[37]||(e[37]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},[x(" 时长（天数） "),t("span",{class:"text-red-500"},"*")],-1)),o(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.duration=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"1",placeholder:"输入天数",required:"",type:"number"},null,512),[[n,a.value.duration,void 0,{number:!0}]])]),t("div",null,[e[38]||(e[38]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},[x(" 每日额度（实际，美元） "),t("span",{class:"text-red-500"},"*")],-1)),o(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.dailyLimitActual=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"0",placeholder:"输入实际每日额度",required:"",step:"0.01",type:"number"},null,512),[[n,a.value.dailyLimitActual,void 0,{number:!0}]])]),t("div",null,[e[39]||(e[39]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},[x(" 每日额度（显示给用户，美元） "),t("span",{class:"text-red-500"},"*")],-1)),o(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.dailyLimitDisplay=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"0",placeholder:"输入显示给用户的每日额度",required:"",step:"0.01",type:"number"},null,512),[[n,a.value.dailyLimitDisplay,void 0,{number:!0}]]),t("p",re," 倍速将自动计算："+m(y.value.toFixed(2))+"x ",1)]),t("div",null,[e[40]||(e[40]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 倍速（可选，手动指定） ",-1)),o(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.speedMultiplier=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",max:"100",min:"0.1",placeholder:`自动计算值：${y.value.toFixed(2)}x`,step:"0.01",type:"number"},null,8,oe),[[n,a.value.speedMultiplier,void 0,{number:!0}]]),t("p",ie," 留空则使用自动计算值（"+m(y.value.toFixed(2))+"x），或手动指定倍速 ",1)]),t("div",null,[e[41]||(e[41]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 描述 ",-1)),o(t("textarea",{"onUpdate:modelValue":e[9]||(e[9]=l=>a.value.description=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"输入套餐描述（可选）",rows:"3"},null,512),[[n,a.value.description]])])],64)):g("",!0),a.value.type==="usage"?(i(),d(R,{key:1},[t("div",null,[e[42]||(e[42]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},[x(" 总额度（实际，美元） "),t("span",{class:"text-red-500"},"*")],-1)),o(t("input",{"onUpdate:modelValue":e[10]||(e[10]=l=>a.value.totalLimitActual=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"0",placeholder:"输入实际总额度",required:"",step:"0.01",type:"number"},null,512),[[n,a.value.totalLimitActual,void 0,{number:!0}]])]),t("div",null,[e[43]||(e[43]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},[x(" 总额度（显示给用户，美元） "),t("span",{class:"text-red-500"},"*")],-1)),o(t("input",{"onUpdate:modelValue":e[11]||(e[11]=l=>a.value.totalLimitDisplay=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"0",placeholder:"输入显示给用户的总额度",required:"",step:"0.01",type:"number"},null,512),[[n,a.value.totalLimitDisplay,void 0,{number:!0}]]),t("p",de," 倍速将自动计算："+m(y.value.toFixed(2))+"x ",1)]),t("div",null,[e[44]||(e[44]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 倍速（可选，手动指定） ",-1)),o(t("input",{"onUpdate:modelValue":e[12]||(e[12]=l=>a.value.speedMultiplier=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",max:"100",min:"0.1",placeholder:`自动计算值：${y.value.toFixed(2)}x`,step:"0.01",type:"number"},null,8,ne),[[n,a.value.speedMultiplier,void 0,{number:!0}]]),t("p",ue," 留空则使用自动计算值（"+m(y.value.toFixed(2))+"x），或手动指定倍速 ",1)])],64)):g("",!0)])):g("",!0),u.value===2?(i(),d("div",me,[e[58]||(e[58]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," 配置 API Key 模板，这些配置将在激活订单时应用到生成的 API Key ",-1)),t("div",null,[e[45]||(e[45]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},[x(" 模板名称 "),t("span",{class:"text-red-500"},"*")],-1)),o(t("input",{"onUpdate:modelValue":e[13]||(e[13]=l=>s.value.name=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"输入模板名称",required:""},null,512),[[n,s.value.name]])]),t("div",null,[e[46]||(e[46]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 每日费用限额（美元） ",-1)),o(t("input",{"onUpdate:modelValue":e[14]||(e[14]=l=>s.value.dailyCostLimit=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"0",placeholder:"输入每日费用限额（0表示无限制）",step:"0.01",type:"number"},null,512),[[n,s.value.dailyCostLimit,void 0,{number:!0}]])]),t("div",null,[e[47]||(e[47]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 总费用限额（美元） ",-1)),o(t("input",{"onUpdate:modelValue":e[15]||(e[15]=l=>s.value.totalCostLimit=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"0",placeholder:"输入总费用限额（0表示无限制）",step:"0.01",type:"number"},null,512),[[n,s.value.totalCostLimit,void 0,{number:!0}]])]),t("div",null,[e[48]||(e[48]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 并发限制 ",-1)),o(t("input",{"onUpdate:modelValue":e[16]||(e[16]=l=>s.value.concurrencyLimit=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"0",placeholder:"输入并发限制（0表示无限制）",type:"number"},null,512),[[n,s.value.concurrencyLimit,void 0,{number:!0}]])]),t("div",pe,[e[52]||(e[52]=t("h4",{class:"mb-2 text-sm font-semibold text-gray-800 dark:text-gray-200"}," 速率限制设置（可选） ",-1)),t("div",ye,[t("div",null,[e[49]||(e[49]=t("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"}," 时间窗口（分钟） ",-1)),o(t("input",{"onUpdate:modelValue":e[17]||(e[17]=l=>s.value.rateLimitWindow=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"1",placeholder:"无限制",type:"number"},null,512),[[n,s.value.rateLimitWindow,void 0,{number:!0}]])]),t("div",null,[e[50]||(e[50]=t("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"}," 请求次数限制 ",-1)),o(t("input",{"onUpdate:modelValue":e[18]||(e[18]=l=>s.value.rateLimitRequests=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"1",placeholder:"无限制",type:"number"},null,512),[[n,s.value.rateLimitRequests,void 0,{number:!0}]])]),t("div",null,[e[51]||(e[51]=t("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"}," 费用限制（美元） ",-1)),o(t("input",{"onUpdate:modelValue":e[19]||(e[19]=l=>s.value.rateLimitCost=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"0",placeholder:"无限制",step:"0.01",type:"number"},null,512),[[n,s.value.rateLimitCost,void 0,{number:!0}]])])])]),t("div",null,[e[53]||(e[53]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Opus 模型周费用限制（美元） ",-1)),o(t("input",{"onUpdate:modelValue":e[20]||(e[20]=l=>s.value.weeklyOpusCostLimit=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"0",placeholder:"输入 Opus 周费用限制（0表示无限制）",step:"0.01",type:"number"},null,512),[[n,s.value.weeklyOpusCostLimit,void 0,{number:!0}]]),e[54]||(e[54]=t("p",{class:"mt-1 text-xs text-gray-500"}," 设置 Opus 模型的周费用限制（周一到周日），仅限 Claude 官方账户 ",-1))]),t("div",null,[e[56]||(e[56]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 权限 ",-1)),o(t("select",{"onUpdate:modelValue":e[21]||(e[21]=l=>s.value.permissions=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white"},e[55]||(e[55]=[t("option",{value:"all"},"全部",-1),t("option",{value:"claude"},"仅 Claude",-1),t("option",{value:"gemini"},"仅 Gemini",-1),t("option",{value:"openai"},"仅 OpenAI",-1),t("option",{value:"droid"},"仅 Droid",-1)]),512),[[K,s.value.permissions]])]),t("div",null,[e[57]||(e[57]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 描述 ",-1)),o(t("textarea",{"onUpdate:modelValue":e[22]||(e[22]=l=>s.value.description=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"输入模板描述（可选）",rows:"3"},null,512),[[n,s.value.description]])])])):g("",!0),u.value===3?(i(),d("div",be,[t("div",null,[e[59]||(e[59]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300"},[x(" 闲鱼链接 "),t("span",{class:"text-red-500"},"*")],-1)),o(t("input",{"onUpdate:modelValue":e[23]||(e[23]=l=>a.value.xianyuLink=l),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"输入闲鱼商品链接",required:"",type:"url"},null,512),[[n,a.value.xianyuLink]]),e[60]||(e[60]=t("p",{class:"mt-1 text-xs text-gray-500"},"用户点击购买时将跳转到此链接",-1))])])):g("",!0),t("div",ge,[u.value>1?(i(),d("button",{key:0,class:"rounded-lg bg-gray-100 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-200 dark:bg-gray-600 dark:text-gray-300 dark:hover:bg-gray-500",type:"button",onClick:e[24]||(e[24]=l=>u.value--)}," 上一步 ")):(i(),d("div",ce)),t("div",xe,[t("button",{class:"rounded-lg bg-gray-100 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-200 dark:bg-gray-600 dark:text-gray-300 dark:hover:bg-gray-500",type:"button",onClick:e[25]||(e[25]=l=>r.$emit("close"))}," 取消 "),u.value<3?(i(),d("button",{key:0,class:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50",disabled:k.value,type:"button",onClick:F}," 下一步 ",8,ve)):(i(),d("button",{key:1,class:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50",disabled:k.value,type:"submit"},m(k.value?"创建中...":c.value?"更新":"创建"),9,fe))])])],32)])])]))}},we={class:"tab-content"},Le={class:"card p-4 sm:p-6"},Ce={class:"mb-4 flex flex-col gap-4 sm:mb-6 sm:flex-row sm:items-center sm:justify-between"},Ae={key:0,class:"flex justify-center py-8"},Ie={key:1,class:"py-8 text-center text-gray-500"},$e={key:2,class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3"},Me={class:"mb-3 flex items-start justify-between"},he={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},De={class:"flex items-center gap-2"},Fe={class:"text-xs text-gray-500"},Ve={class:"mb-3 space-y-1 text-sm text-gray-600 dark:text-gray-400"},Ue={class:"flex justify-between"},Re={class:"font-semibold text-gray-900 dark:text-gray-100"},qe={key:0,class:"flex justify-between"},je={class:"font-semibold text-gray-900 dark:text-gray-100"},Oe={key:1,class:"flex justify-between"},Pe={class:"font-semibold text-gray-900 dark:text-gray-100"},Te={key:2,class:"flex justify-between"},Ke={class:"font-semibold text-gray-900 dark:text-gray-100"},Se={key:3,class:"flex justify-between"},We={class:"font-semibold text-gray-900 dark:text-gray-100"},ze={key:4,class:"flex justify-between"},Be={class:"font-semibold text-gray-900 dark:text-gray-100"},Ee={key:5,class:"flex justify-between"},Ne={class:"font-semibold text-gray-900 dark:text-gray-100"},Ge={class:"mt-4 flex gap-2"},Qe=["onClick"],Ye=["onClick"],tt={__name:"PlanManagementView",setup(q){const{showConfirmModal:h,confirmOptions:b,showConfirm:D,handleConfirm:k,handleCancel:u}=N(),c=f(!1),a=f([]),s=f(!1),y=f(null),L=async()=>{c.value=!0;try{const r=await v.get("/admin/plans?includeInactive=true");r&&r.success&&(a.value=r.data||[])}catch(r){A("加载套餐列表失败","error"),console.error("Failed to load plans:",r)}finally{c.value=!1}},F=r=>{y.value=r},$=async r=>{console.log("deletePlan called with planId:",r);try{const e=await D({title:"确认删除",message:"确定要删除这个套餐吗？此操作不可恢复。"});if(console.log("User confirmed:",e),!e){console.log("User cancelled deletion");return}const l=await v.delete(`/admin/plans/${r}`);l&&l.success?(A("套餐删除成功","success"),await L()):A("删除套餐失败","error")}catch(e){A("删除套餐失败","error"),console.error("Failed to delete plan:",e)}},M=()=>{s.value=!1,y.value=null},V=()=>{M(),L()};return W(()=>{L()}),(r,e)=>(i(),d("div",we,[t("div",Le,[t("div",Ce,[e[2]||(e[2]=t("div",null,[t("h3",{class:"mb-1 text-lg font-bold text-gray-900 dark:text-gray-100 sm:mb-2 sm:text-xl"}," 套餐管理 "),t("p",{class:"text-sm text-gray-600 dark:text-gray-400 sm:text-base"},"管理套餐配置和定价")],-1)),t("button",{class:"btn btn-primary flex items-center gap-2 px-4 py-2 text-sm font-medium",onClick:e[0]||(e[0]=l=>s.value=!0)},e[1]||(e[1]=[t("i",{class:"fas fa-plus"},null,-1),x(" 创建套餐 ",-1)]))]),c.value?(i(),d("div",Ae,e[3]||(e[3]=[t("div",{class:"loading-spinner"},null,-1)]))):a.value.length===0?(i(),d("div",Ie,' 暂无套餐，点击"创建套餐"开始 ')):(i(),d("div",$e,[(i(!0),d(R,null,B(a.value,l=>(i(),d("div",{key:l.id,class:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800"},[t("div",Me,[t("div",null,[t("h4",he,m(l.name),1),t("span",{class:I(["mt-1 inline-block rounded-full px-2 py-0.5 text-xs font-medium",l.type==="monthly"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200"])},m(l.type==="monthly"?"月卡":"计量"),3)]),t("div",De,[t("span",{class:I(["h-2 w-2 rounded-full",l.isActive?"bg-green-500":"bg-gray-400"])},null,2),t("span",Fe,m(l.isActive?"启用":"禁用"),1)])]),t("div",Ve,[t("div",Ue,[e[4]||(e[4]=t("span",null,"价格：",-1)),t("span",Re," ¥"+m(l.price),1)]),l.type==="monthly"?(i(),d("div",qe,[e[5]||(e[5]=t("span",null,"每日额度（显示）：",-1)),t("span",je," $"+m(l.dailyLimitDisplay),1)])):g("",!0),l.type==="monthly"?(i(),d("div",Oe,[e[6]||(e[6]=t("span",null,"每日额度（实际）：",-1)),t("span",Pe," $"+m(l.dailyLimitActual),1)])):g("",!0),l.type==="monthly"?(i(),d("div",Te,[e[7]||(e[7]=t("span",null,"倍速：",-1)),t("span",Ke,m(l.speedMultiplier)+"x ",1)])):g("",!0),l.type==="usage"?(i(),d("div",Se,[e[8]||(e[8]=t("span",null,"总额度（显示）：",-1)),t("span",We," $"+m(l.totalLimitDisplay),1)])):g("",!0),l.type==="usage"?(i(),d("div",ze,[e[9]||(e[9]=t("span",null,"总额度（实际）：",-1)),t("span",Be," $"+m(l.totalLimitActual),1)])):g("",!0),l.type==="usage"?(i(),d("div",Ee,[e[10]||(e[10]=t("span",null,"倍速：",-1)),t("span",Ne,m(l.speedMultiplier)+"x ",1)])):g("",!0)]),t("div",Ge,[t("button",{class:"flex-1 rounded-lg bg-blue-100 px-3 py-1.5 text-sm font-medium text-blue-700 hover:bg-blue-200 dark:bg-blue-900 dark:text-blue-200 dark:hover:bg-blue-800",onClick:p=>F(l)}," 编辑 ",8,Qe),t("button",{class:"flex-1 rounded-lg bg-red-100 px-3 py-1.5 text-sm font-medium text-red-700 hover:bg-red-200 dark:bg-red-900 dark:text-red-200 dark:hover:bg-red-800",onClick:p=>$(l.id)}," 删除 ",8,Ye)])]))),128))]))]),s.value||y.value?(i(),P(ke,{key:0,plan:y.value,onClose:M,onSuccess:V},null,8,["plan"])):g("",!0),z(E,{"cancel-text":w(b).cancelText,"confirm-text":w(b).confirmText,message:w(b).message,show:w(h),title:w(b).title,onCancel:w(u),onConfirm:w(k)},null,8,["cancel-text","confirm-text","message","show","title","onCancel","onConfirm"])]))}};export{tt as default};
